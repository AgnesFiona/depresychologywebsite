<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Psychology Season</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --light: #f8fafc;
            --dark: #2d3748;
            --gray: #718096;
            --border: #e2e8f0;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --info: #4299e1;
            --sidebar-width: 280px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f5f7fa;
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        .admin-sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            color: white;
            box-shadow: 2px 0 20px rgba(0,0,0,0.2);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo-image {
            width: 240px;
            height: 100px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .logo-content {
            padding: 15px;
            text-align: center;
            width: 100%;
        }

        .logo-main-text {
            font-size: 22px;
            font-weight: 800;
            color: #4a5568;
            margin-bottom: 5px;
            letter-spacing: 0.5px;
        }

        .logo-subtitle-text {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }

        .logo-tagline-text {
            font-size: 10px;
            color: #718096;
            line-height: 1.4;
            font-style: italic;
        }

        .logo-tagline-text p {
            margin: 3px 0;
        }

        .sidebar-logo h1 {
            font-size: 20px;
            font-weight: 700;
            color: white;
            line-height: 1.3;
            margin-top: 5px;
        }

        .sidebar-logo .logo-subtitle {
            font-size: 13px;
            color: rgba(255,255,255,0.9);
            font-weight: 500;
            padding-bottom: 5px;
        }

        .sidebar-logo .logo-tagline {
            font-size: 11px;
            color: rgba(255,255,255,0.7);
            font-weight: 300;
            line-height: 1.4;
            font-style: italic;
            margin-top: 5px;
        }

        .sidebar-logo .logo-tagline p {
            margin-bottom: 3px;
        }

        .admin-profile {
            padding: 20px;
            background: rgba(0,0,0,0.1);
            margin: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .admin-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            background: #48bb78;
            border-radius: 50%;
            position: relative;
        }

        .status-indicator::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: #48bb78;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        .status-text {
            font-size: 13px;
            font-weight: 500;
            color: rgba(255,255,255,0.9);
        }

        .admin-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: white;
        }

        .admin-details {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            line-height: 1.5;
        }

        .admin-details strong {
            color: white;
            font-weight: 600;
        }

        .last-login {
            font-size: 11px;
            color: rgba(255,255,255,0.7);
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sidebar-nav {
            flex: 1;
            padding: 15px 0;
            overflow-y: auto;
        }

        .nav-title {
            padding: 0 20px 8px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.6);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
            margin: 2px 0;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: rgba(255,255,255,0.3);
        }

        .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            border-left-color: white;
        }

        .nav-item i {
            width: 18px;
            text-align: center;
            font-size: 16px;
        }

        .nav-item span {
            font-weight: 500;
            font-size: 14px;
        }

        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            width: calc(100% - var(--sidebar-width));
            overflow-x: hidden;
        }

        .admin-header {
            background: white;
            padding: 0 30px;
            height: var(--header-height);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-left h2 {
            font-size: 20px;
            color: var(--dark);
            font-weight: 600;
        }

        .header-left p {
            font-size: 14px;
            color: var(--gray);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .calendar-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            font-size: 14px;
        }

        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: #e53e3e;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
        }

        .admin-content {
            padding: 30px;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
        }

        .content-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .section-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            color: var(--primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 12px;
            padding: 25px;
            color: white;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
            min-width: 0;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .users-table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid var(--border);
            margin-bottom: 30px;
            width: 100%;
            max-width: 100%;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .users-table th {
            background: var(--light);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
        }

        .users-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
            color: var(--gray);
        }

        .users-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .user-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-active {
            background: #c6f6d5;
            color: #276749;
        }

        .status-inactive {
            background: #fed7d7;
            color: #9b2c2c;
        }

        .user-role {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .role-admin {
            background: #c3dafe;
            color: #2c5282;
        }

        .role-user {
            background: #e9d8fd;
            color: #553c9a;
        }

        .role-superadmin {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
        }

        .search-container {
            margin-bottom: 25px;
            width: 100%;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-icon.view {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary);
        }

        .btn-icon.view:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .btn-icon.delete {
            background: rgba(245, 101, 101, 0.1);
            color: var(--danger);
        }

        .btn-icon.delete:hover {
            background: rgba(245, 101, 101, 0.2);
        }

        .btn-icon.edit {
            background: rgba(237, 137, 54, 0.1);
            color: var(--warning);
        }

        .btn-icon.edit:hover {
            background: rgba(237, 137, 54, 0.2);
        }

        .activity-card {
            background: var(--light);
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .activity-list {
            margin-top: 20px;
        }

        .activity-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            gap: 15px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            background: var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .activity-details {
            flex: 1;
            min-width: 0;
        }

        .activity-user {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .activity-action {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 3px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--gray);
        }

        .admin-footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            border-top: 1px solid var(--border);
            margin-top: 40px;
            flex-shrink: 0;
            width: 100%;
        }
        
        .tab-content {
            display: none;
            width: 100%;
        }

        .tab-content.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }
        
        .user-detail-row {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .user-detail-label {
            flex: 0 0 150px;
            font-weight: 600;
            color: var(--dark);
        }

        .user-detail-value {
            flex: 1;
            color: var(--gray);
        }

        .test-history {
            margin-top: 30px;
        }

        .test-history table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .test-history th {
            background: var(--light);
            padding: 10px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
        }

        .test-history td {
            padding: 10px;
            border-bottom: 1px solid var(--border);
            color: var(--gray);
        }

        .analysis-chart {
            margin: 30px 0;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .chart-container {
            height: 300px;
            width: 100%;
            position: relative;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .password-input-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .password-toggle:hover {
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .admin-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                width: 280px;
            }
        
            .admin-sidebar.active {
                transform: translateX(0);
            }
        
            .main-content {
                margin-left: 0;
                width: 100%;
            }
        
            .mobile-menu-btn {
                display: block;
                background: none;
                border: none;
                font-size: 24px;
                color: var(--primary);
                cursor: pointer;
            }
        
            .header-right {
                flex-direction: column;
                gap: 10px;
                align-items: flex-end;
            }
        
            .header-info {
                flex-direction: column;
                align-items: flex-end;
                gap: 10px;
            }
        
            .admin-header {
                padding: 0 15px;
            }
        }

        @media (max-width: 768px) {
            .admin-content {
                padding: 15px;
            }
        
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .content-section {
                padding: 20px;
            }
        
            .admin-header {
                padding: 0 15px;
                height: auto;
                min-height: var(--header-height);
                flex-wrap: wrap;
            }
        
            .logout-btn {
                padding: 6px 12px;
                font-size: 14px;
            }
        
            .search-box {
                flex-direction: column;
            }
        
            .search-input {
                min-width: 100%;
            }
        
            .user-detail-row {
                flex-direction: column;
            }
        
            .user-detail-label {
                flex: none;
                margin-bottom: 5px;
            }
        
            .logo-image {
                width: 200px;
                height: 90px;
            }
        
            .logo-main-text {
                font-size: 20px;
            }
        
            .logo-subtitle-text {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        
            .header-left h2 {
                font-size: 18px;
            }
        
            .section-title {
                font-size: 18px;
            }
            
            .content-section {
                padding: 15px;
            }
        
            .sidebar-logo h1 {
                font-size: 18px;
            }
            
            .sidebar-logo .logo-subtitle {
                font-size: 12px;
            }
        
            .sidebar-logo .logo-tagline {
                font-size: 10px;
            }
        
            .logo-image {
                width: 180px;
                height: 80px;
            }
        
            .logo-main-text {
                font-size: 18px;
            }
        
            .logo-subtitle-text {
                font-size: 12px;
            }
        }

        .sidebar-footer {
            padding: 15px 20px;
            margin-top: auto;
            text-align: center;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-footer p {
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 3px;
        }

        .sidebar-footer .version {
            font-size: 9px;
            color: rgba(255,255,255,0.4);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="admin-sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <!-- Logo Image Section - UPDATED -->
                <div class="logo-image">
                    <img src="Logo Depression Web.png" alt="Psychology Season - Depression Edition" style="width: 100%; height: 100%; object-fit: contain; padding: 5px;">
                </div>
            </div>
        </div>

        <!-- Admin Profile -->
        <div class="admin-profile">
            <div class="admin-status">
                <div class="status-indicator"></div>
                <span class="status-text">Administrator Profile</span>
            </div>
            <div class="admin-info">
                <h3>Si Admin Psikolog</h3>
                <div class="admin-details">
                    <div><strong>ID:</strong> admin_001</div>
                    <div><strong>Role:</strong> Admin Psikologi</div>
                    <div><strong>Email:</strong> adminpsyc@admin.com</div>
                </div>
                <div class="last-login">
                    <i class="fas fa-clock"></i> Last login: 16 Jan 2026, 21.42
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <div class="nav-title">ADMIN MENU</div>
        <div class="sidebar-nav">
            <a href="#" class="nav-item active" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-tab="users">
                <i class="fas fa-users"></i>
                <span>Manajemen User</span>
            </a>
            <a href="#" class="nav-item" data-tab="ahp">
                <i class="fas fa-chart-bar"></i>
                <span>Analisis AHP-LR</span>
            </a>
            <a href="#" class="nav-item" data-tab="settings">
                <i class="fas fa-cog"></i>
                <span>Pengaturan Sistem</span>
            </a>
        </div>
        
        <!-- Copyright in Sidebar -->
        <div class="sidebar-footer">
            <p>© 2026 Psychology Season</p>
            <p class="version">Version 2.0 | Admin System</p>
        </div>
    </div>
   
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="admin-header">
            <div class="header-left">
                <button class="mobile-menu-btn" id="mobileMenuBtn" style="display: none;">
                    <i class="fas fa-bars"></i>
                </button>
                <div>
                    <h2 id="page-title">Dashboard Admin</h2>
                    <p>Monitor dan kelola sistem assessment psikologis</p>
                </div>
            </div>
        
            <div class="header-right">
                <div class="header-info">
                    <div class="calendar-info">
                        <i class="fas fa-calendar-alt"></i>
                        <span id="current-date">16 Januari 2026</span>
                    </div>
                    <button class="logout-btn" onclick="logoutAdmin()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="admin-content">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="content-section">
                    <h2 class="section-title">
                        <span class="section-icon"><i class="fas fa-tachometer-alt"></i></span>
                        Dashboard Overview
                    </h2>
                
                    <div class="stats-grid">
                       <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-users"></i></div>
                            <div class="stat-number" id="total-users">0</div>
                            <div class="stat-label">Total Users</div>
                        </div>
                    
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-user-check"></i></div>
                            <div class="stat-number" id="active-users">0</div>
                            <div class="stat-label">Active Users</div>
                        </div>
                    
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                            <div class="stat-number" id="today-logins">0</div>
                            <div class="stat-label">Today Logins</div>
                        </div>
                    
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                            <div class="stat-number" id="growth-rate">0%</div>
                            <div class="stat-label">Growth Rate</div>
                        </div>
                    </div>
                
                    <div class="section-title" style="margin-top: 40px;">
                        <span class="section-icon"><i class="fas fa-info-circle"></i></span>
                        Informasi Sistem
                    </div>
                    
                    <div style="background: var(--light); padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <p><strong>Admin System - Psychology Season</strong></p>
                        <p>Dashboard admin untuk memantau pengguna sistem assessment psikologis fokus pada kesehatan mental dan depresi.</p>
                        <p><i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i> <strong>Catatan:</strong> Analisis AHP-LR lengkap tersedia di user dashboard.</p>
                    </div>
                </div>
            </div>
        
            <!-- Users Management Tab -->
            <div id="users-tab" class="tab-content">
                <div class="content-section">
                    <h2 class="section-title">
                        <span class="section-icon"><i class="fas fa-users"></i></span>
                        Manajemen User
                    </h2>
                
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" class="search-input" id="user-search" placeholder="Cari user berdasarkan nama atau email...">
                            <button class="btn btn-primary" onclick="searchUsers()">
                                <i class="fas fa-search"></i> Cari
                            </button>
                            <button class="btn" onclick="resetSearch()">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                            <button class="btn btn-success" onclick="showAddAdminModal()">
                                <i class="fas fa-plus"></i> Tambah Admin
                            </button>
                        </div>
                    </div>
                
                    <div class="users-table-container">
                        <table class="users-table" id="users-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Email</th>
                                    <th>Jenis Kelamin</th>
                                    <th>Usia</th>
                                    <th>Status</th>
                                    <th>Role</th>
                                    <th>Login Terakhir</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Aktivitas Terkini -->
                    <div class="activity-card">
                        <h3 class="section-title" style="font-size: 18px; margin-bottom: 20px;">
                            <i class="fas fa-clock"></i> Aktivitas Terkini
                        </h3>
                    
                        <div class="activity-list" id="recent-activity-list">
                            <!-- Recent activity items will be loaded here -->
                            <div style="text-align: center; padding: 30px; color: var(--gray);">
                                <i class="fas fa-clock" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                                <p>Tidak ada aktivitas terkini</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- AHP-LR Analysis Tab -->
            <div id="ahp-tab" class="tab-content">
                <div class="content-section">
                    <h2 class="section-title">
                        <span class="section-icon"><i class="fas fa-chart-bar"></i></span>
                        Analisis AHP-LR
                    </h2>
                
                    <div style="background: var(--light); padding: 25px; border-radius: 10px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: var(--primary);">Ringkasan Analisis</h3>
                        <p>Analisis Analytical Hierarchy Process - Logistic Regression untuk prediksi risiko depresi.</p>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                                <div style="font-size: 24px; font-weight: bold; color: var(--primary);" id="total-analyses">0</div>
                                <div style="font-size: 14px; color: var(--gray);">Total Analisis</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid var(--success);">
                                <div style="font-size: 24px; font-weight: bold; color: var(--success);" id="low-risk">0</div>
                                <div style="font-size: 14px; color: var(--gray);">Risiko Rendah</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                                <div style="font-size: 24px; font-weight: bold; color: var(--warning);" id="medium-risk">0</div>
                                <div style="font-size: 14px; color: var(--gray);">Risiko Sedang</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger);">
                                <div style="font-size: 24px; font-weight: bold; color: var(--danger);" id="high-risk">0</div>
                                <div style="font-size: 14px; color: var(--gray);">Risiko Tinggi</div>
                            </div>
                        </div>
                    </div>
                
                    <div class="users-table-container">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>ID Analisis</th>
                                    <th>User</th>
                                    <th>Tanggal</th>
                                    <th>Skor AHP</th>
                                    <th>Prediksi LR</th>
                                    <th>Risiko</th>
                                </tr>
                            </thead>
                            <tbody id="ahp-table-body">
                                <!-- AHP-LR analyses will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        
            <!-- System Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="content-section">
                    <h2 class="section-title">
                        <span class="section-icon"><i class="fas fa-cog"></i></span>
                        Pengaturan Sistem
                    </h2>
                
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                        <div>
                            <h3 style="margin-bottom: 20px; color: var(--primary);">Umum</h3>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Nama Sistem</label>
                                <input type="text" class="search-input" id="system-name" value="Psychology Season" style="width: 100%;">
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Email Admin</label>
                                <input type="email" class="search-input" id="admin-email" value="adminpsyc@admin.com" style="width: 100%;">
                            </div>
                            <button class="btn btn-primary" onclick="saveGeneralSettings()">
                                <i class="fas fa-save"></i> Simpan Perubahan
                            </button>
                        </div>
                    
                        <div>
                            <h3 style="margin-bottom: 20px; color: var(--primary);">Keamanan</h3>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Reset Password</label>
                                <div class="password-input-container">
                                    <input type="password" class="search-input" id="new-password" placeholder="Password baru" style="width: 100%; margin-bottom: 10px;">
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('new-password', 'toggle-new-password')">
                                        <i class="fas fa-eye" id="toggle-new-password"></i>
                                    </button>
                                </div>
                                <div class="password-input-container">
                                    <input type="password" class="search-input" id="confirm-password" placeholder="Konfirmasi password" style="width: 100%;">
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirm-password', 'toggle-confirm-password')">
                                        <i class="fas fa-eye" id="toggle-confirm-password"></i>
                                    </button>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Auto-logout (menit)</label>
                                <input type="number" class="search-input" id="auto-logout" value="30" min="1" max="120" style="width: 100%;">
                            </div>
                            <button class="btn btn-primary" onclick="updateSecuritySettings()">
                                <i class="fas fa-shield-alt"></i> Update Keamanan
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <h3 style="margin-bottom: 20px; color: var(--primary);">Backup & Restore</h3>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button class="btn" onclick="backupData()">
                                <i class="fas fa-download"></i> Backup Data
                            </button>
                            <button class="btn" onclick="restoreData()">
                                <i class="fas fa-history"></i> Restore Data
                            </button>
                            <button class="btn btn-danger" onclick="clearAllData()">
                                <i class="fas fa-trash"></i> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Footer -->
        <div class="admin-footer">
            <p>© 2026 Depresychologycal Admin Dashboard. Hak cipta dilindungi undang-undang.</p>
            <p style="font-size: 12px; margin-top: 5px;">Edisi Kesehatan Mental "Depresi" | Admin System Only</p>
        </div>
    </div>

    <!-- Modal untuk Detail User -->
    <div class="modal" id="userDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detail User</h3>
                <button class="modal-close" onclick="closeUserDetailModal()">&times;</button>
            </div>
            <div id="userDetailContent">
                <!-- Detail user akan dimuat di sini -->
            </div>
        </div>
    </div>

    <!-- Modal untuk Tambah Admin -->
    <div class="modal" id="addAdminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Admin Baru</h3>
                <button class="modal-close" onclick="closeAddAdminModal()">&times;</button>
            </div>
            <div id="addAdminContent">
                <form id="addAdminForm">
                    <div class="form-group">
                        <label class="form-label">ID Admin</label>
                        <input type="text" class="form-control" id="admin-id" value="admin_" readonly>
                        <small style="color: var(--gray);">ID akan digenerate otomatis (admin_001, admin_002, dst)</small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nama Lengkap *</label>
                            <input type="text" class="form-control" id="admin-name" required placeholder="Masukkan nama admin">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-control" id="admin-email-input" required placeholder="Masukkan email admin">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Jenis Kelamin</label>
                            <select class="form-select" id="admin-gender">
                                <option value="other">Lainnya</option>
                                <option value="male">Laki-laki</option>
                                <option value="female">Perempuan</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Usia</label>
                            <input type="text" class="form-control" id="admin-age" value="N/A" readonly>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <input type="text" class="form-control" id="admin-status-input" value="Aktif" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <input type="text" class="form-control" id="admin-role-input" value="Admin" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <div class="password-input-container">
                            <input type="password" class="form-control" id="admin-password" required placeholder="Masukkan password admin">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('admin-password', 'toggle-admin-password')">
                                <i class="fas fa-eye" id="toggle-admin-password"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Konfirmasi Password *</label>
                        <div class="password-input-container">
                            <input type="password" class="form-control" id="admin-confirm-password" required placeholder="Konfirmasi password">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('admin-confirm-password', 'toggle-admin-confirm-password')">
                                <i class="fas fa-eye" id="toggle-admin-confirm-password"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button type="button" class="btn" onclick="closeAddAdminModal()">
                            <i class="fas fa-times"></i> Batal
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Simpan Admin
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal untuk Edit User -->
    <div class="modal" id="editUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit User</h3>
                <button class="modal-close" onclick="closeEditUserModal()">&times;</button>
            </div>
            <div id="editUserContent">
                <!-- Form edit user akan dimuat di sini -->
            </div>
        </div>
    </div>

    <script>
        const ADMIN_EMAILS = [
            'adminpsyc@admin.com',
            'admin@depresychology.com',
            'adminkonsul@admin.com',
            'adminpsiki@admin.com'
        ];

        // SUPER ADMIN yang tidak bisa dihapus
        const SUPER_ADMIN_EMAILS = [
            'adminpsyc@admin.com'
        ];

        // Check if admin is logged in
        function checkAdminLogin() {
            try {
                const sessionAdmin = sessionStorage.getItem('currentAdmin');
                const localAdmin = localStorage.getItem('currentAdmin');
            
                if (!sessionAdmin && !localAdmin) {
                    window.location.href = 'index.html';
                    return false;
                }
            
                return true;
            } catch (error) {
                window.location.href = 'index.html';
                return false;
            }
        }

        // Logout admin
        function logoutAdmin() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                sessionStorage.removeItem('currentAdmin');
                localStorage.removeItem('currentAdmin');
                window.location.href = 'index.html';
            }
        }

        // Tab switching
        function setupTabs() {
            const tabs = document.querySelectorAll('.nav-item');
            const tabContents = document.querySelectorAll('.tab-content');
        
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                
                    tab.classList.add('active');
                
                    // Show corresponding content
                    const tabName = tab.getAttribute('data-tab');
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                    
                    // Update page title
                    const pageTitle = document.getElementById('page-title');
                    switch(tabName) {
                        case 'dashboard':
                            pageTitle.textContent = 'Dashboard Admin';
                            document.querySelector('.header-left p').textContent = 'Monitor dan kelola sistem assessment psikologis';
                            loadDashboardStats();
                            break;
                        case 'users':
                            pageTitle.textContent = 'Manajemen User';
                            document.querySelector('.header-left p').textContent = 'Kelola data pengguna sistem';
                            loadUsers();
                            loadRecentActivityList();
                            break;
                        case 'ahp':
                            pageTitle.textContent = 'Analisis AHP-LR';
                            document.querySelector('.header-left p').textContent = 'Analisis risiko depresi dengan AHP-LR';
                            loadAHPAnalysis();
                            break;
                        case 'settings':
                            pageTitle.textContent = 'Pengaturan Sistem';
                            document.querySelector('.header-left p').textContent = 'Kelola konfigurasi sistem Psychology Season';
                            loadSettings();
                            break;
                    }
                
                    // Close sidebar on mobile
                    if (window.innerWidth <= 992) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });
        }

        // Set current date
        function setCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('id-ID', options);
            document.getElementById('current-date').textContent = dateString;
        }

        // Toggle password visibility
        function togglePasswordVisibility(inputId, toggleId) {
            const passwordInput = document.getElementById(inputId);
            const toggleIcon = document.getElementById(toggleId);
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        // Load dashboard statistics
        function loadDashboardStats() {
            try {
                const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
                const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');

                // Filter hanya user non-admin
                const regularUsers = users.filter(user => !ADMIN_EMAILS.includes(user.email.toLowerCase()));
                document.getElementById('total-users').textContent = regularUsers.length;

                // Active users (logged in last 7 days)
                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

                const activeUsers = regularUsers.filter(user => {
                    if (!user.lastLogin) return false;
                    return new Date(user.lastLogin) >= sevenDaysAgo;
                });

                document.getElementById('active-users').textContent = activeUsers.length;

                // Today logins
                const today = new Date().toDateString();
                const todayLogins = logs.filter(log => {
                    const logDate = new Date(log.timestamp).toDateString();
                    return logDate === today && log.action.includes('Login') && log.status === 'success';
                });

                document.getElementById('today-logins').textContent = todayLogins.length;

                // Growth rate (dummy calculation)
                const growthRate = regularUsers.length > 10 ? '12.5%' : '0%';
                document.getElementById('growth-rate').textContent = growthRate;

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        // Load recent activity list for users management tab
        function loadRecentActivityList() {
            try {
                const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');
                const activityList = document.getElementById('recent-activity-list');

                const recentLogs = logs.slice(0, 5);
                
                if (recentLogs.length === 0) {
                    activityList.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--gray);">
                        <i class="fas fa-clock" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                        <p>Tidak ada aktivitas terkini</p>
                        </div>
                        `;
                        return;
                    }

                    let activityHTML = '';

                    recentLogs.forEach(log => {
                        const timeAgo = getTimeAgo(new Date(log.timestamp));
                        const iconClass = getActivityIcon(log.action);
                        const iconColor = log.status === 'success' ? 'var(--success)' : 'var(--danger)';
            
                        activityHTML += `
                        <div class="activity-item">
                            <div class="activity-icon" style="background: ${iconColor};">
                                <i class="${iconClass}"></i>
                            </div>
                            <div class="activity-details">
                                <div class="activity-user">${log.userName || 'System'}</div>
                                <div class="activity-action">${log.action}</div>
                                <div class="activity-time">${timeAgo}</div>
                            </div>
                        </div>
                        `;
                    });

                    activityList.innerHTML = activityHTML;

                } catch (error) {
                    console.error('Error loading recent activity list:', error);
                }
            }

            // Helper function for activity icon
            function getActivityIcon(action) {
                if (action.includes('Login')) return 'fas fa-sign-in-alt';
                if (action.includes('Logout')) return 'fas fa-sign-out-alt';
                if (action.includes('Tambah') || action.includes('Add')) return 'fas fa-plus-circle';
                if (action.includes('Hapus') || action.includes('Delete')) return 'fas fa-trash';
                if (action.includes('Update') || action.includes('Ubah')) return 'fas fa-edit';
                return 'fas fa-history';
            }

            // Helper function for time ago
            function getTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) return 'Baru saja';
                if (diffMins < 60) return `${diffMins} menit lalu`;
                if (diffHours < 24) return `${diffHours} jam lalu`;
                if (diffDays < 7) return `${diffDays} hari lalu`;
                return date.toLocaleDateString('id-ID');
            }

            // Load users - SEMUA BISA DIHAPUS KECUALI SUPER ADMIN
            function loadUsers() {
                try {
                    const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
                    const tableBody = document.getElementById('users-table-body');
                    tableBody.innerHTML = '';
                
                    // Filter out demo users
                    const filteredUsers = users.filter(user => user.id !== 'demo_002');

                    if (filteredUsers.length === 0) {
                        createInitialData();
                        return loadUsers();
                    }

                    filteredUsers.forEach(user => {
                        const row = document.createElement('tr');
                        
                        // Determine status
                        const isActive = user.lastLogin ? 
                        (Date.now() - new Date(user.lastLogin).getTime() < 7 * 24 * 60 * 60 * 1000) : false;
            
                        // Determine role
                        let role = user.role || 'User';
                        let roleClass = 'role-user';
                        
                        if (ADMIN_EMAILS.includes(user.email.toLowerCase())) {
                            role = 'Admin';
                            roleClass = 'role-admin';
                        }
                        
                        // Check if super admin
                        const isSuperAdmin = SUPER_ADMIN_EMAILS.includes(user.email.toLowerCase());
                        if (isSuperAdmin) {
                            role = 'Super Admin';
                            roleClass = 'role-superadmin';
                        }
            
                        row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.gender === 'male' ? 'Laki-laki' : user.gender === 'female' ? 'Perempuan' : 'Lainnya'}</td>
                        <td>${user.age || 'N/A'}</td>
                        <td>
                            <span class="user-status ${isActive ? 'status-active' : 'status-inactive'}">
                                ${isActive ? 'Aktif' : 'Tidak Aktif'}
                                </span>
                        </td>
                        <td>
                            <span class="user-role ${roleClass}">
                                ${role}
                            </span>
                        </td>
                        <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString('id-ID') : 'Belum pernah'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon view" onclick="viewUserDetail('${user.id}')" title="Lihat Detail">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${role === 'Admin' || role === 'Super Admin' ? `
                                    <button class="btn-icon edit" onclick="editUser('${user.id}')" title="Edit User">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                ` : ''}
                                ${!isSuperAdmin ? `
                                    <button class="btn-icon delete" onclick="deleteUser('${user.id}')" title="Hapus User">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                        `;
            
                        tableBody.appendChild(row);
                    });

                } catch (error) {
                    console.error('Error loading users:', error);
                }
            }

            // Create initial data
            function createInitialData() {
                const initialUsers = [
                    {
                        id: 'admin_001',
                        name: 'Admin Depresychology',
                        email: 'admin@depresychology.com',
                        gender: 'other',
                        age: 'N/A',
                        role: 'admin',
                        password: 'admin123',
                        createdAt: new Date('2026-01-01').toISOString(),
                        lastLogin: new Date('2026-01-16 00:01:01').toISOString()
                    },
                    {
                        id: 'user_1768927994488',
                        name: 'Agnes Fiona',
                        email: 'agnesfionaiga@gmail.com',
                        gender: 'female',
                        age: 22,
                        role: 'user',
                        password: 'user123',
                        createdAt: new Date('2026-01-20').toISOString(),
                        lastLogin: new Date('2026-01-21 11:30:25').toISOString()
                    }
                ];

                localStorage.setItem('psycho_users', JSON.stringify(initialUsers));

                const initialLogs = [
                    {
                        id: 'log_1',
                        timestamp: new Date('2026-01-16 00:01:01').toISOString(),
                        userName: 'Admin Depresychology',
                        role: 'admin',
                        action: 'Login admin',
                        status: 'success',
                        ip: '192.168.1.1'
                    },
                    {
                        id: 'log_2',
                        timestamp: new Date('2026-01-21 11:30:25').toISOString(),
                        userName: 'Agnes Fiona',
                        role: 'user',
                        action: 'Login ke sistem',
                        status: 'success',
                        ip: '192.168.1.2'
                    }
                ];

                localStorage.setItem('system_logs', JSON.stringify(initialLogs));
            }

            // Function to get next admin ID
            function getNextAdminId() {
                const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
                const adminUsers = users.filter(user => user.id.startsWith('admin_'));
                
                if (adminUsers.length === 0) {
                    return 'admin_001';
                }
                
                // Get the highest admin number
                let maxNum = 0;
                adminUsers.forEach(admin => {
                    const num = parseInt(admin.id.replace('admin_', ''));
                    if (!isNaN(num) && num > maxNum) {
                        maxNum = num;
                    }
                });
                
                // Format with leading zeros
                const nextNum = maxNum + 1;
                return `admin_${nextNum.toString().padStart(3, '0')}`;
            }

            function loadAHPAnalysis() {
                try {
                    const ahpData = JSON.parse(localStorage.getItem('ahp_analyses') || '[]');
                    const tableBody = document.getElementById('ahp-table-body');
                    tableBody.innerHTML = '';

                    document.getElementById('total-analyses').textContent = ahpData.length;

                    const lowRisk = ahpData.filter(item => item.risk === 'low').length;
                    const mediumRisk = ahpData.filter(item => item.risk === 'medium').length;
                    const highRisk = ahpData.filter(item => item.risk === 'high').length;

                    document.getElementById('low-risk').textContent = lowRisk;
                    document.getElementById('medium-risk').textContent = mediumRisk;
                    document.getElementById('high-risk').textContent = highRisk;

                    if (ahpData.length === 0) {
                        tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <i class="fas fa-chart-bar" style="font-size: 48px; color: var(--gray); margin-bottom: 15px; display: block;"></i>
                                <p>Tidak ada data analisis AHP-LR</p>
                                <p style="font-size: 14px; color: var(--gray); margin-top: 10px;">
                                    Data analisis akan muncul setelah user mengikuti assessment
                                    </p>
                            </td>
                        </tr>
                    `;
                    return;
                    }

                    // Tampilkan semua analisis
                    ahpData.forEach(analysis => {
                        const row = document.createElement('tr');
                        const riskColor = analysis.risk === 'high' ? 'var(--danger)' : 
                        analysis.risk === 'medium' ? 'var(--warning)' : 'var(--success)';
                        const riskText = analysis.risk === 'high' ? 'Tinggi' : 
                        analysis.risk === 'medium' ? 'Sedang' : 'Rendah';
            
                        row.innerHTML = `
                        <td>${analysis.id}</td>
                        <td>${analysis.userName}</td>
                        <td>${new Date(analysis.date).toLocaleDateString('id-ID')}</td>
                        <td>${analysis.ahpScore ? analysis.ahpScore.toFixed(2) : '0.00'}</td>
                        <td>${analysis.lrPrediction ? (analysis.lrPrediction * 100).toFixed(1) + '%' : '0.0%'}</td>
                        <td><span style="color: ${riskColor}; font-weight: 600;">${riskText}</span></td>
                        `;
            
                        tableBody.appendChild(row);
                    });

                } catch (error) {
                    console.error('Error loading AHP analysis:', error);
                }
            }

            // View user detail in modal
            function viewUserDetail(userId) {
                const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
                const user = users.find(u => u.id === userId);

                if (!user) {
                    alert('User tidak ditemukan!');
                    return;
                }

                // Determine role
                let role = user.role || 'User';
                if (ADMIN_EMAILS.includes(user.email.toLowerCase())) {
                    role = 'Admin';
                }
                if (SUPER_ADMIN_EMAILS.includes(user.email.toLowerCase())) {
                    role = 'Super Admin';
                }

                // Get test history for this user
                const testHistory = getUserTestHistory(userId);
                const ahpAnalysis = getAHPAnalysisForUser(userId);

                let detailHTML = `
                <div class="user-detail-row">
                    <div class="user-detail-label">ID User:</div>
                    <div class="user-detail-value">${user.id}</div>
                </div>
                <div class="user-detail-row">
                    <div class="user-detail-label">Nama Lengkap:</div>
                    <div class="user-detail-value">${user.name}</div>
                </div>
                <div class="user-detail-row">
                    <div class="user-detail-label">Email:</div>
                    <div class="user-detail-value">${user.email}</div>
                </div>
                <div class="user-detail-row">
                    <div class="user-detail-label">Jenis Kelamin:</div>
                    <div class="user-detail-value">${user.gender === 'male' ? 'Laki-laki' : user.gender === 'female' ? 'Perempuan' : 'Lainnya'}</div>
                    </div>
                    <div class="user-detail-row">
                        <div class="user-detail-label">Usia:</div>
                        <div class="user-detail-value">${user.age || 'N/A'}</div>
                    </div>
                <div class="user-detail-row">
                    <div class="user-detail-label">Role:</div>
                    <div class="user-detail-value">
                        <span class="user-role ${role === 'Super Admin' ? 'role-superadmin' : role === 'Admin' ? 'role-admin' : 'role-user'}">
                            ${role}
                        </span>
                    </div>
                </div>
                <div class="user-detail-row">
                    <div class="user-detail-label">Tanggal Registrasi:</div>
                    <div class="user-detail-value">${new Date(user.createdAt).toLocaleString('id-ID')}</div>
                    </div>
                    <div class="user-detail-row">
                        <div class="user-detail-label">Login Terakhir:</div>
                        <div class="user-detail-value">${user.lastLogin ? new Date(user.lastLogin).toLocaleString('id-ID') : 'Belum pernah'}</div>
                    </div>
            `;

            // Add test history if available
            if (testHistory.length > 0) {
                detailHTML += `
                <div class="test-history">
                    <h4 style="margin-top: 20px; color: var(--primary);">Riwayat Assessment</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Jenis Tes</th>
                                <th>Tanggal</th>
                                <th>Skor</th>
                                <th>Hasil</th>
                            </tr>
                        </thead>
                    <tbody>
                `;

                testHistory.forEach(test => {
                    detailHTML += `
                    <tr>
                        <td>${test.testType}</td>
                        <td>${new Date(test.date).toLocaleDateString('id-ID')}</td>
                        <td>${test.score || 'N/A'}</td>
                        <td>${test.result || 'N/A'}</td>
                    </tr>
                    `;
                });

                detailHTML += `
                </tbody>
                </table>
                </div>
                `;
            }

            // Add AHP-LR analysis if available
            if (ahpAnalysis) {
                const riskColor = ahpAnalysis.risk === 'high' ? 'var(--danger)' : 
                ahpAnalysis.risk === 'medium' ? 'var(--warning)' : 'var(--success)';
                const riskText = ahpAnalysis.risk === 'high' ? 'Tinggi' : 
                ahpAnalysis.risk === 'medium' ? 'Sedang' : 'Rendah';

                detailHTML += `
                <div class="test-history">
                    <h4 style="margin-top: 20px; color: var(--primary);">Analisis AHP-LR Terintegrasi</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: var(--light); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 20px; font-weight: bold; color: var(--primary);">${ahpAnalysis.ahpScore ? ahpAnalysis.ahpScore.toFixed(2) : '0.00'}</div>
                            <div style="font-size: 14px; color: var(--gray);">Skor AHP</div>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 20px; font-weight: bold; color: var(--primary);">${ahpAnalysis.lrPrediction ? (ahpAnalysis.lrPrediction * 100).toFixed(1) + '%' : '0.0%'}</div>
                            <div style="font-size: 14px; color: var(--gray);">Prediksi LR</div>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 8px; border-left: 4px solid ${riskColor};">
                            <div style="font-size: 20px; font-weight: bold; color: ${riskColor};">${riskText}</div>
                            <div style="font-size: 14px; color: var(--gray);">Tingkat Risiko</div>
                        </div>
                    </div>
        
                    <div style="margin-top: 20px; background: var(--light); padding: 15px; border-radius: 8px;">
                        <h5 style="margin-bottom: 10px; color: var(--dark);">Analisis Klinis:</h5>
                        <p style="color: var(--gray);">${getClinicalAnalysis(ahpAnalysis.risk)}</p>
                    </div>
                    <div style="margin-top: 15px; background: var(--light); padding: 15px; border-radius: 8px;">
                        <h5 style="margin-bottom: 10px; color: var(--dark);">Condition Summary:</h5>
                        <p style="color: var(--gray);">${getConditionSummary(ahpAnalysis)}</p>
                    </div>
                </div>
                `;
            }

            document.getElementById('userDetailContent').innerHTML = detailHTML;
            document.getElementById('userDetailModal').style.display = 'flex';
        }

        function closeUserDetailModal() {
            document.getElementById('userDetailModal').style.display = 'none';
        }

        function getUserTestHistory(userId) {
            try {
                const testHistory = JSON.parse(localStorage.getItem('test_history') || '[]');
                return testHistory.filter(test => test.userId === userId);
            } catch (error) {
                console.error('Error getting test history:', error);
                return [];
            }
        }

        function getAHPAnalysisForUser(userId) {
            try {
                const ahpData = JSON.parse(localStorage.getItem('ahp_analyses') || '[]');
                const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
                const user = users.find(u => u.id === userId);

                if (user) {
                    return ahpData.find(analysis => analysis.userName === user.name);
                }

                return null;
            } catch (error) {
                console.error('Error getting AHP analysis:', error);
                return null;
            }
        }

        // Generate clinical analysis based on risk level
        function getClinicalAnalysis(risk) {
            switch(risk) {
                case 'high':
                    return 'Berdasarkan analisis AHP-LR, user menunjukkan indikasi risiko depresi yang tinggi. Disarankan untuk melakukan konsultasi dengan profesional kesehatan mental. Faktor-faktor yang berkontribusi termasuk gejala depresi berat, gangguan tidur, dan penurunan fungsi sosial.';
                case 'medium':
                    return 'User menunjukkan gejala depresi tingkat sedang. Meskipun tidak dalam kondisi kritis, disarankan untuk melakukan monitoring rutin dan penerapan strategi coping yang sehat. Intervensi dini dapat mencegah perkembangan ke tahap yang lebih serius.';
                case 'low':
                    return 'User berada dalam kondisi mental yang relatif sehat dengan risiko depresi rendah. Tetap disarankan untuk menjaga gaya hidup sehat dan kesadaran akan kesehatan mental.';
                default:
                    return 'Analisis klinis tidak tersedia untuk tingkat risiko ini.';
            }
        }

        // Generate condition summary based on AHP analysis
        function getConditionSummary(analysis) {
            if (!analysis || !analysis.factors) {
                return 'Tidak ada data condition summary yang tersedia.';
            }

            const factors = analysis.factors.join(', ');
            return `Kondisi saat ini menunjukkan faktor-faktor berikut: ${factors}. Berdasarkan integrasi analisis AHP dan Logistic Regression, user dikategorikan dalam risiko ${analysis.risk === 'high' ? 'tinggi' : analysis.risk === 'medium' ? 'sedang' : 'rendah'} untuk mengalami depresi.`;
        }

        // Show add admin modal
        function showAddAdminModal() {
            // Generate unique admin ID (admin_001, admin_002, dst)
            const adminId = getNextAdminId();
            document.getElementById('admin-id').value = adminId;
            
            // Reset form
            document.getElementById('addAdminForm').reset();
            document.getElementById('admin-id').value = adminId;
            document.getElementById('admin-age').value = 'N/A';
            document.getElementById('admin-status-input').value = 'Aktif';
            document.getElementById('admin-role-input').value = 'Admin';
            
            document.getElementById('addAdminModal').style.display = 'flex';
        }

        // Close add admin modal
        function closeAddAdminModal() {
            document.getElementById('addAdminModal').style.display = 'none';
        }

        // Handle add admin form submission
        document.getElementById('addAdminForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const adminId = document.getElementById('admin-id').value;
            const name = document.getElementById('admin-name').value.trim();
            const email = document.getElementById('admin-email-input').value.trim();
            const gender = document.getElementById('admin-gender').value;
            const password = document.getElementById('admin-password').value;
            const confirmPassword = document.getElementById('admin-confirm-password').value;
            
            // Validasi
            if (!name || !email || !password) {
                alert('Semua field bertanda * harus diisi!');
                return;
            }
            
            if (!email.includes('@')) {
                alert('Email tidak valid!');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Password dan konfirmasi password tidak sama!');
                return;
            }
            
            if (password.length < 6) {
                alert('Password minimal 6 karakter!');
                return;
            }
            
            try {
                const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
                
                // Cek apakah email sudah ada
                if (users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
                    alert('Email sudah terdaftar!');
                    return;
                }
                
                const newAdmin = {
                    id: adminId,
                    name: name,
                    email: email,
                    gender: gender,
                    age: 'N/A',
                    role: 'admin',
                    password: password, // Dalam aplikasi nyata, ini harus di-hash
                    createdAt: new Date().toISOString(),
                    lastLogin: null
                };
                
                users.push(newAdmin);
                localStorage.setItem('psycho_users', JSON.stringify(users));
                
                // Tambahkan ke daftar admin
                if (!ADMIN_EMAILS.includes(email.toLowerCase())) {
                    ADMIN_EMAILS.push(email.toLowerCase());
                }
                
                // Add to logs
                const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');
                logs.unshift({
                    id: 'log_' + Date.now(),
                    timestamp: new Date().toISOString(),
                    userName: 'Admin',
                    role: 'admin',
                    action: `Tambah admin baru: ${name} (${adminId})`,
                    status: 'success',
                    ip: '127.0.0.1'
                });
                
                localStorage.setItem('system_logs', JSON.stringify(logs));
                
                alert(`Admin ${name} (${adminId}) berhasil ditambahkan!`);
                closeAddAdminModal();
                loadUsers();
                loadRecentActivityList();
                
            } catch (error) {
                alert('Error menambahkan admin: ' + error.message);
            }
        });

        // Edit user
        function editUser(userId) {
            const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
            const user = users.find(u => u.id === userId);
            
            if (!user) {
                alert('User tidak ditemukan!');
                return;
            }
            
            // Hanya admin yang bisa diedit
            if (!ADMIN_EMAILS.includes(user.email.toLowerCase())) {
                alert('Hanya admin yang bisa diedit!');
                return;
            }
            
            const editFormHTML = `
                <form id="editUserForm">
                    <div class="form-group">
                        <label class="form-label">ID Admin</label>
                        <input type="text" class="form-control" value="${user.id}" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nama Lengkap *</label>
                        <input type="text" class="form-control" id="edit-name" value="${user.name}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" id="edit-email" value="${user.email}" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Jenis Kelamin</label>
                            <select class="form-select" id="edit-gender">
                                <option value="other" ${user.gender === 'other' ? 'selected' : ''}>Lainnya</option>
                                <option value="male" ${user.gender === 'male' ? 'selected' : ''}>Laki-laki</option>
                                <option value="female" ${user.gender === 'female' ? 'selected' : ''}>Perempuan</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="edit-status">
                                <option value="active" selected>Aktif</option>
                                <option value="inactive">Tidak Aktif</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password Baru (kosongkan jika tidak ingin mengganti)</label>
                        <div class="password-input-container">
                            <input type="password" class="form-control" id="edit-password" placeholder="Masukkan password baru">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('edit-password', 'toggle-edit-password')">
                                <i class="fas fa-eye" id="toggle-edit-password"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button type="button" class="btn" onclick="closeEditUserModal()">
                            <i class="fas fa-times"></i> Batal
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Simpan Perubahan
                        </button>
                    </div>
                </form>
            `;
            
            document.getElementById('editUserContent').innerHTML = editFormHTML;
            
            // Handle form submission
            document.getElementById('editUserForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveUserChanges(userId);
            });
            
            document.getElementById('editUserModal').style.display = 'flex';
        }

        // Save user changes
        function saveUserChanges(userId) {
            const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex === -1) {
                alert('User tidak ditemukan!');
                return;
            }
            
            const name = document.getElementById('edit-name').value.trim();
            const email = document.getElementById('edit-email').value.trim();
            const gender = document.getElementById('edit-gender').value;
            const newPassword = document.getElementById('edit-password').value;
            
            if (!name || !email) {
                alert('Nama dan email harus diisi!');
                return;
            }
            
            if (!email.includes('@')) {
                alert('Email tidak valid!');
                return;
            }
            
            // Cek apakah email sudah digunakan oleh user lain
            const emailExists = users.some((u, index) => 
                index !== userIndex && u.email.toLowerCase() === email.toLowerCase()
            );
            
            if (emailExists) {
                alert('Email sudah digunakan oleh user lain!');
                return;
            }
            
            // Update user data
            users[userIndex].name = name;
            users[userIndex].email = email;
            users[userIndex].gender = gender;
            
            // Update password jika diisi
            if (newPassword) {
                if (newPassword.length < 6) {
                    alert('Password minimal 6 karakter!');
                    return;
                }
                users[userIndex].password = newPassword;
            }
            
            // Update role jika email berubah
            if (ADMIN_EMAILS.includes(email.toLowerCase())) {
                users[userIndex].role = 'admin';
            }
            
            localStorage.setItem('psycho_users', JSON.stringify(users));
            
            // Update ADMIN_EMAILS jika email berubah
            const oldEmail = users[userIndex].email;
            if (oldEmail !== email) {
                const oldEmailIndex = ADMIN_EMAILS.indexOf(oldEmail.toLowerCase());
                if (oldEmailIndex !== -1) {
                    ADMIN_EMAILS.splice(oldEmailIndex, 1);
                }
                if (!ADMIN_EMAILS.includes(email.toLowerCase())) {
                    ADMIN_EMAILS.push(email.toLowerCase());
                }
            }
            
            // Add to logs
            const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');
            logs.unshift({
                id: 'log_' + Date.now(),
                timestamp: new Date().toISOString(),
                userName: 'Admin',
                role: 'admin',
                action: `Edit admin: ${name} (${userId})`,
                status: 'success',
                ip: '127.0.0.1'
            });
            
            localStorage.setItem('system_logs', JSON.stringify(logs));
            
            alert('Data admin berhasil diperbarui!');
            closeEditUserModal();
            loadUsers();
            loadRecentActivityList();
        }

        // Close edit user modal
        function closeEditUserModal() {
            document.getElementById('editUserModal').style.display = 'none';
        }

        // Search users
        function searchUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase().trim();
            const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
            const tableBody = document.getElementById('users-table-body');

            if (!searchTerm) {
                loadUsers();
                return;
            }

            const filteredUsers = users.filter(user => 
            user.name.toLowerCase().includes(searchTerm) || 
            user.email.toLowerCase().includes(searchTerm)
        );

        tableBody.innerHTML = '';

        if (filteredUsers.length === 0) {
            tableBody.innerHTML = `
            <tr>
                <td colspan="9" style="text-align: center; padding: 40px;">
                    <i class="fas fa-search" style="font-size: 48px; color: var(--gray); margin-bottom: 15px; display: block;"></i>
                    <p>Tidak ada user ditemukan untuk "${searchTerm}"</p>
                </td>
            </tr>
            `;
            return;
        }

        filteredUsers.forEach(user => {
            const row = document.createElement('tr');
            const isActive = user.lastLogin ? 
            (Date.now() - new Date(user.lastLogin).getTime() < 7 * 24 * 60 * 60 * 1000) : false;
            
            // Determine role
            let role = user.role || 'User';
            let roleClass = 'role-user';
            
            if (ADMIN_EMAILS.includes(user.email.toLowerCase())) {
                role = 'Admin';
                roleClass = 'role-admin';
            }
            
            const isSuperAdmin = SUPER_ADMIN_EMAILS.includes(user.email.toLowerCase());
            if (isSuperAdmin) {
                role = 'Super Admin';
                roleClass = 'role-superadmin';
            }

            row.innerHTML = `
            <td>${user.id}</td>
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>${user.gender === 'male' ? 'Laki-laki' : user.gender === 'female' ? 'Perempuan' : 'Lainnya'}</td>
            <td>${user.age || 'N/A'}</td>
            <td>
                <span class="user-status ${isActive ? 'status-active' : 'status-inactive'}">
                    ${isActive ? 'Aktif' : 'Tidak Aktif'}
                </span>
            </td>
            <td>
                <span class="user-role ${roleClass}">
                    ${role}
                </span>
            </td>
            <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString('id-ID') : 'Belum pernah'}</td>
            <td>
                <div class="action-buttons">
                    <button class="btn-icon view" onclick="viewUserDetail('${user.id}')" title="Lihat Detail">
                        <i class="fas fa-eye"></i>
                    </button>
                    ${role === 'Admin' || role === 'Super Admin' ? `
                        <button class="btn-icon edit" onclick="editUser('${user.id}')" title="Edit User">
                            <i class="fas fa-edit"></i>
                        </button>
                    ` : ''}
                    ${!isSuperAdmin ? `
                        <button class="btn-icon delete" onclick="deleteUser('${user.id}')" title="Hapus User">
                            <i class="fas fa-trash"></i>
                        </button>
                    ` : ''}
                </div>
            </td>
            `;

            tableBody.appendChild(row);
        });
    }

    // Reset search
    function resetSearch() {
        document.getElementById('user-search').value = '';
        loadUsers();
    }

    // Delete user - SEMUA BISA DIHAPUS KECUALI SUPER ADMIN
    function deleteUser(userId) {
        const users = JSON.parse(localStorage.getItem('psycho_users') || '[]');
        const user = users.find(u => u.id === userId);

        if (!user) return;

        // Cek apakah user adalah super admin (tidak bisa dihapus)
        if (SUPER_ADMIN_EMAILS.includes(user.email.toLowerCase())) {
            alert('Tidak dapat menghapus akun Super Admin!');
            return;
        }

        if (!confirm(`Apakah Anda yakin ingin menghapus user "${user.name}"? Tindakan ini tidak dapat dibatalkan.`)) {
            return;
        }

        try {
            const filteredUsers = users.filter(u => u.id !== userId);

            localStorage.setItem('psycho_users', JSON.stringify(filteredUsers));

            // Hapus dari ADMIN_EMAILS jika yang dihapus adalah admin
            if (ADMIN_EMAILS.includes(user.email.toLowerCase())) {
                const emailIndex = ADMIN_EMAILS.indexOf(user.email.toLowerCase());
                if (emailIndex !== -1) {
                    ADMIN_EMAILS.splice(emailIndex, 1);
                }
            }

            // Add to logs
            const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');
            logs.unshift({
                id: 'log_' + Date.now(),
                timestamp: new Date().toISOString(),
                userName: 'Admin',
                role: 'admin',
                action: `Hapus ${user.role === 'admin' ? 'admin' : 'user'}: ${user.name}`,
                status: 'success',
                ip: '127.0.0.1'
            });

            localStorage.setItem('system_logs', JSON.stringify(logs));

            alert(`${user.role === 'admin' ? 'Admin' : 'User'} "${user.name}" berhasil dihapus!`);
            loadUsers();
            loadRecentActivityList();

        } catch (error) {
            alert('Error menghapus user: ' + error.message);
        }
    }

    // Load settings
    function loadSettings() {
        try {
            const settings = JSON.parse(localStorage.getItem('system_settings') || '{}');

            // Set auto-logout value
            if (settings.autoLogoutMinutes) {
                document.getElementById('auto-logout').value = settings.autoLogoutMinutes;
            }

            // Set system name and email if saved
            if (settings.systemName) {
                document.getElementById('system-name').value = settings.systemName;
            }

            if (settings.adminEmail) {
                document.getElementById('admin-email').value = settings.adminEmail;
            }
        } catch (error) {
            console.error('Error loading settings:', error);
        }
    }

    // Save general settings
    function saveGeneralSettings() {
        const systemName = document.getElementById('system-name').value;
        const adminEmail = document.getElementById('admin-email').value;

        if (!systemName.trim()) {
            alert('Nama sistem tidak boleh kosong!');
            return;
        }

        if (!adminEmail.includes('@')) {
            alert('Email admin tidak valid!');
            return;
        }

        try {
            const settings = JSON.parse(localStorage.getItem('system_settings') || '{}');
            settings.systemName = systemName;
            settings.adminEmail = adminEmail;
            settings.lastUpdated = new Date().toISOString();

            localStorage.setItem('system_settings', JSON.stringify(settings));

            // Update juga di ADMIN_EMAILS array jika email admin berubah
            if (!ADMIN_EMAILS.includes(adminEmail.toLowerCase())) {
                ADMIN_EMAILS.push(adminEmail.toLowerCase());
            }

            // Add to logs
            const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');
            logs.unshift({
                id: 'log_' + Date.now(),
                timestamp: new Date().toISOString(),
                userName: 'Admin',
                role: 'admin',
                action: 'Update pengaturan umum sistem',
                status: 'success',
                ip: '127.0.0.1'
            });

            localStorage.setItem('system_logs', JSON.stringify(logs));

            alert('Pengaturan umum berhasil disimpan!');
        } catch (error) {
            alert('Error menyimpan pengaturan: ' + error.message);
        }
    }

    // Update security settings
    function updateSecuritySettings() {
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        const autoLogout = document.getElementById('auto-logout').value;

        // Validasi password
        if (newPassword || confirmPassword) {
            if (newPassword !== confirmPassword) {
                alert('Password dan konfirmasi password tidak sama!');
                return;
            }
            if (newPassword.length < 6) {
                alert('Password minimal 6 karakter!');
                return;
            }

            // Simpan password (dalam real app, ini harus di-hash)
            try {
                const settings = JSON.parse(localStorage.getItem('system_settings') || '{}');
                settings.passwordLastChanged = new Date().toISOString();
                localStorage.setItem('system_settings', JSON.stringify(settings));
    
                // Add to logs
                const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');
                logs.unshift({
                    id: 'log_' + Date.now(),
                    timestamp: new Date().toISOString(),
                    userName: 'Admin',
                    role: 'admin',
                    action: 'Update password admin',
                    status: 'success',
                    ip: '127.0.0.1'
                });
    
                localStorage.setItem('system_logs', JSON.stringify(logs));
    
                alert('Password berhasil diubah!');
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-password').value = '';
            } catch (error) {
                alert('Error mengubah password: ' + error.message);
            }
        }

        // Simpan auto-logout setting
        if (autoLogout && autoLogout >= 1 && autoLogout <= 120) {
            const settings = JSON.parse(localStorage.getItem('system_settings') || '{}');
            settings.autoLogoutMinutes = parseInt(autoLogout);
            settings.lastUpdated = new Date().toISOString();
            localStorage.setItem('system_settings', JSON.stringify(settings));

            // Add to logs
            const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');
            logs.unshift({
                id: 'log_' + Date.now(),
                timestamp: new Date().toISOString(),
                userName: 'Admin',
                role: 'admin',
                action: `Update auto-logout ke ${autoLogout} menit`,
                status: 'success',
                ip: '127.0.0.1'
            });

            localStorage.setItem('system_logs', JSON.stringify(logs));

            alert(`Auto-logout diatur ke ${autoLogout} menit!`);
        } else {
            alert('Auto-logout harus antara 1-120 menit!');
        }
    }

    // Backup data
    function backupData() {
        try {
            const data = {
                users: JSON.parse(localStorage.getItem('psycho_users') || '[]'),
                logs: JSON.parse(localStorage.getItem('system_logs') || '[]'),
                ahpAnalyses: JSON.parse(localStorage.getItem('ahp_analyses') || '[]'),
                testHistory: JSON.parse(localStorage.getItem('test_history') || '[]'),
                settings: JSON.parse(localStorage.getItem('system_settings') || '{}'),
                adminEmails: ADMIN_EMAILS,
                superAdminEmails: SUPER_ADMIN_EMAILS,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `psychology_season_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            alert('Backup data berhasil!');

        } catch (error) {
            alert('Error membuat backup: ' + error.message);
        }
    }

    // Restore data
    function restoreData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';

        input.onchange = function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                try {
                    const data = JSON.parse(event.target.result);
        
                    if (confirm('Restore data akan mengganti semua data yang ada. Lanjutkan?')) {
                        localStorage.setItem('psycho_users', JSON.stringify(data.users || []));
                        localStorage.setItem('system_logs', JSON.stringify(data.logs || []));
                        localStorage.setItem('ahp_analyses', JSON.stringify(data.ahpAnalyses || []));
                        localStorage.setItem('test_history', JSON.stringify(data.testHistory || []));
                        localStorage.setItem('system_settings', JSON.stringify(data.settings || {}));
            
                        // Restore admin emails
                        if (data.adminEmails) {
                            ADMIN_EMAILS.length = 0;
                            data.adminEmails.forEach(email => ADMIN_EMAILS.push(email));
                        }
            
                        // Restore super admin emails
                        if (data.superAdminEmails) {
                            SUPER_ADMIN_EMAILS.length = 0;
                            data.superAdminEmails.forEach(email => SUPER_ADMIN_EMAILS.push(email));
                        }
            
                        alert('Data berhasil di-restore!');
                        location.reload();
                    }
                } catch (error) {
                    alert('File backup tidak valid: ' + error.message);
                }
            };

            reader.readAsText(file);
        };

        input.click();
    }

    // Clear all data
    function clearAllData() {
        if (confirm('PERINGATAN: Ini akan menghapus SEMUA data termasuk users, logs, dan analisis. Tindakan ini tidak dapat dibatalkan. Lanjutkan?')) {
            localStorage.removeItem('psycho_users');
            localStorage.removeItem('system_logs');
            localStorage.removeItem('ahp_analyses');
            localStorage.removeItem('test_history');
            localStorage.removeItem('system_settings');

            alert('Semua data telah dihapus. Sistem akan direfresh.');
            location.reload();
        }
    }

    // Toggle mobile menu
    function toggleMobileMenu() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('active');
    }

    // Initialize admin dashboard
    document.addEventListener('DOMContentLoaded', function() {
        // Check admin login
        if (!checkAdminLogin()) {
            return;
        }

        setCurrentDate();
        setupTabs();
        loadDashboardStats();
        
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', toggleMobileMenu);

            // Show/hide mobile menu button based on screen size
            function checkScreenSize() {
                if (window.innerWidth <= 992) {
                    mobileMenuBtn.style.display = 'block';
                } else {
                    mobileMenuBtn.style.display = 'none';
                    document.getElementById('sidebar').classList.remove('active');
                }
            }

            checkScreenSize();
            window.addEventListener('resize', checkScreenSize);
        }

        // Prevent horizontal scroll
        window.addEventListener('resize', function() {
            document.body.style.overflowX = 'hidden';
        });

        // Auto-hide sidebar on mobile when clicking content
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 992) {
                const sidebar = document.getElementById('sidebar');
                const isClickInsideSidebar = sidebar.contains(event.target);
                const isClickOnMenuButton = mobileMenuBtn.contains(event.target);
    
                if (!isClickInsideSidebar && !isClickOnMenuButton && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                }
            }
        });

        // Close modals when clicking outside
        document.getElementById('userDetailModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeUserDetailModal();
            }
        });

        document.getElementById('addAdminModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAddAdminModal();
            }
        });

        document.getElementById('editUserModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeEditUserModal();
            }
        });
    });
    </script>
</body>
</html>s
