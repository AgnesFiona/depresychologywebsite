<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard - Depresychology</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
        
            :root {
                --primary: #667eea;
                --primary-dark: #5a67d8;
                --secondary: #764ba2;
                --light: #f8fafc;
                --dark: #2d3748;
                --gray: #718096;
                --border: #e2e8f0;
                --success: #48bb78;
                --warning: #ed8936;
                --danger: #f56565;
                --info: #4299e1;
                --sidebar-width: 280px;
            }
        
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                color: var(--dark);
                background: #f5f7fa;
                min-height: 100vh;
                display: flex;
                overflow-x: hidden;
            }
        
            .sidebar {
                width: var(--sidebar-width);
                background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
                color: white;
                padding: 20px 0;
                height: 100vh;
                position: fixed;
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
                display: flex;
                flex-direction: column;
                overflow: hidden;
                z-index: 1000;
            }
        
            .sidebar-content {
                padding: 0 15px;
                flex: 1;
                display: flex;
                flex-direction: column;
                height: 100%;
                overflow: hidden;
            }
        
            .brand-section {
                margin-bottom: 25px;
                text-align: center;
                padding: 0 10px;
                flex-shrink: 0;
            }
        
            .brand-icon {
                width: 60px;
                height: 60px;
                margin: 0 auto 12px auto;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.2);
            }
        
            .brand-logo-img {
                width: 50px;
                height: 50px;
                object-fit: contain;
            }
        
            .brand-name {
                font-size: 22px;
                font-weight: 700;
                margin-bottom: 3px;
            }
        
            .brand-tagline {
                font-size: 12px;
                opacity: 0.9;
                letter-spacing: 0.5px;
                white-space: nowrap;
            }
        
            .user-section {
                margin-bottom: 25px;
                flex-shrink: 0;
            }
        
            .user-card {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                padding: 15px;
                backdrop-filter: blur(10px);
            }
        
            .user-name {
                display: flex;
                justify-content: center;
                gap: 6px;
                margin-bottom: 10px;
                font-size: 16px;
                font-weight: 600;
                white-space: nowrap;
            }
        
            .user-status {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-bottom: 15px;
                font-size: 13px;
            }
        
            .user-details {
                background: rgba(255, 255, 255, 0.08);
                border-radius: 8px;
                padding: 12px;
            }
        
            .detail-item {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 8px;
                font-size: 12px;
            }
        
            .detail-item:last-child {
                margin-bottom: 0;
            }
        
            .detail-item .detail-icon {
                width: 14px;
                text-align: center;
                flex-shrink: 0;
            }
        
            .detail-item span {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex: 1;
            }
            
            .menu-checkbox {
                width: 14px;
                height: 14px;
                border: 2px solid rgba(255, 255, 255, 0.5);
                border-radius: 3px;
                margin-right: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }
        
            .menu-checkbox.checked::after {
                content: '‚úì';
                font-size: 10px;
                color: white;
            }
        
            .menu-checkbox.unchecked {
                background: rgba(255, 255, 255, 0.1);
            }
            
            .menu-section {
                margin-bottom: 15px;
                flex: 1;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }
        
            .menu-title {
                font-size: 11px;
                text-transform: uppercase;
                letter-spacing: 0.8px;
                margin: 0 0 12px 8px;
                opacity: 0.7;
                font-weight: 600;
                white-space: nowrap;
                flex-shrink: 0;
            }
        
            .menu-items-container {
                flex: 1;
                overflow-y: auto;
                overflow-x: hidden;
                scrollbar-width: none;
                -ms-overflow-style: none;
                padding-right: 3px;
            }
        
            .menu-items-container::-webkit-scrollbar {
                display: none;
            }
        
            .menu-item {
                display: flex;
                align-items: center;
                padding: 10px 12px;
                border-radius: 8px;
                margin-bottom: 6px;
                transition: all 0.2s ease;
                cursor: pointer;
                text-decoration: none;
                color: white;
                font-size: 13px;
                min-width: 0;
                flex-shrink: 0;
            }
        
            .menu-item:hover {
                background: rgba(255, 255, 255, 0.15);
                transform: translateX(3px);
            }
        
            .menu-item.active {
                background: rgba(255, 255, 255, 0.2);
                font-weight: 600;
            }
        
            .menu-item.active .menu-checkbox {
                border-color: white;
            }
        
            .menu-item.active .menu-checkbox.unchecked::after {
                content: '‚úì';
                font-size: 10px;
                color: white;
            }
        
            .menu-icon {
                font-size: 14px;
                margin-right: 10px;
                width: 18px;
                text-align: center;
                flex-shrink: 0;
            }
        
            .menu-text {
                font-size: 13px;
                flex: 1;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                line-height: 1.4;
                white-space: normal;
                word-wrap: break-word;
                max-height: 36px;
                line-clamp: 2;
                box-orient: vertical;
            }
        
            .logout-section {
                margin-top: auto;
                padding: 10px 0;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                flex-shrink: 0;
            }
            .logout-menu-item {
                display: flex;
                align-items: center;
                padding: 10px 12px;
                border-radius: 8px;
                transition: all 0.2s ease;
                cursor: pointer;
                text-decoration: none;
                color: #fed7d7;
                background: rgba(245, 101, 101, 0.15);
                border: 1px solid rgba(245, 101, 101, 0.3);
                font-size: 13px;
            }
        
            .logout-menu-item:hover {
                background: rgba(245, 101, 101, 0.25);
                transform: translateX(3px);
                color: #fff5f5;
                border-color: rgba(245, 101, 101, 0.5);
            }
        
            .logout-menu-icon {
                font-size: 14px;
                margin-right: 10px;
                width: 18px;
                text-align: center;
                flex-shrink: 0;
            }
        
            .logout-menu-text {
                font-size: 13px;
                flex: 1;
                font-weight: 600;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        
            .logout-menu-checkbox {
                width: 14px;
                height: 14px;
                border: 2px solid rgba(245, 101, 101, 0.5);
                border-radius: 3px;
                margin-right: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(245, 101, 101, 0.1);
                flex-shrink: 0;
            }
        
            .logout-menu-checkbox.unchecked::after {
                content: 'üö™';
                font-size: 9px;
                color: #fed7d7;
            }
        
            .main-content {
                flex: 1;
                margin-left: var(--sidebar-width);
                padding: 25px;
                min-height: 100vh;
                overflow-y: auto;
                padding-bottom: 40px;
                width: calc(100% - var(--sidebar-width));
            }
        
            .header {
                margin-bottom: 25px;
            }
        
            .page-title {
                font-size: 26px;
                font-weight: 700;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 10px;
            }
        
            .page-icon {
                font-size: 22px;
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
            }
        
            .welcome-section {
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                border-radius: 14px;
                padding: 25px;
                color: white;
                margin-bottom: 25px;
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
            }
        
            .welcome-title {
                font-size: 22px;
                font-weight: 700;
                margin-bottom: 8px;
            }
        
            .welcome-message {
                font-size: 15px;
                opacity: 0.9;
                margin-bottom: 18px;
                line-height: 1.5;
            }
        
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 20px;
                margin-bottom: 25px;
            }
        
            .stat-card {
                background: white;
                border-radius: 14px;
                padding: 20px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
        
            .stat-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 12px;
            }
        
            .stat-icon {
                font-size: 22px;
                color: var(--primary);
            }
        
            .stat-title {
                font-size: 13px;
                font-weight: 600;
                color: var(--gray);
            }
        
            .stat-value {
                font-size: 24px;
                font-weight: 700;
                margin-bottom: 6px;
                color: var(--dark);
            }
        
            .stat-trend {
                font-size: 11px;
                color: var(--success);
            }
        
            .stat-trend.negative {
                color: var(--danger);
            }
            
            .mood-tracker {
                background: white;
                border-radius: 14px;
                padding: 25px;
                margin-bottom: 25px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
        
            .mood-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
                gap: 12px;
                margin-top: 15px;
            }
        
            .mood-option {
                background: var(--light);
                border-radius: 10px;
                padding: 15px;
                text-align: center;
                cursor: pointer;
                border: 2px solid transparent;
                transition: all 0.3s ease;
            }
        
            .mood-option:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
        
            .mood-option.selected {
                border-color: var(--primary);
                background: rgba(102, 126, 234, 0.1);
            }
        
            .mood-emoji {
                font-size: 28px;
                margin-bottom: 8px;
            }
        
            .mood-label {
                font-size: 13px;
                font-weight: 600;
                color: var(--dark);
            }
            
            .activity-history {
                background: white;
                border-radius: 14px;
                padding: 25px;
                margin-bottom: 30px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
        
            .section-title {
                font-size: 20px;
                font-weight: 700;
                margin-bottom: 20px;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 10px;
            }
        
            .section-icon {
                color: var(--primary);
            }
        
            .history-list {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }
        
            .history-item {
                display: flex;
                align-items: center;
                padding: 12px;
                background: var(--light);
                border-radius: 10px;
                border: 1px solid var(--border);
                transition: all 0.2s ease;
            }
        
            .history-item:hover {
                background: #f0f4ff;
                transform: translateX(3px);
            }
        
            .history-icon {
                font-size: 18px;
                margin-right: 12px;
                color: var(--primary);
                flex-shrink: 0;
            }
        
            .history-content {
                flex: 1;
                min-width: 0;
            }
        
            .history-title {
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 4px;
                color: var(--dark);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .history-time {
                font-size: 13px;
                color: var(--gray);
            }
        
            .empty-history {
                text-align: center;
                padding: 30px;
                color: var(--gray);
            }
        
            .empty-history i {
                font-size: 36px;
                margin-bottom: 15px;
                display: block;
                color: var(--border);
            }
            
            .quick-actions {
                background: white;
                border-radius: 14px;
                padding: 25px;
                margin-bottom: 30px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
            
            .footer {
                text-align: center;
                padding: 25px 15px 15px;
                color: var(--gray);
                margin-top: 30px;
                border-top: 1px solid var(--border);
            }
        
            .footer-logo {
                font-size: 18px;
                font-weight: 700;
                color: var(--primary);
                margin-bottom: 6px;
            }
            
            .copyright {
                font-size: 13px;
                opacity: 0.8;
            }
            
            @media (max-width: 1024px) {
                :root {
                    --sidebar-width: 240px;
                }
            
                .main-content {
                    padding: 20px;
                    width: calc(100% - 240px);
                }
            
                .menu-text {
                    font-size: 12px;
                }
            }
        
            @media (max-width: 768px) {
                body {
                    flex-direction: column;
                }
            
                .sidebar {
                    width: 100%;
                    height: auto;
                    position: relative;
                    padding: 15px 0;
                    max-height: 70vh;
                    overflow-y: auto;
                }
            
                .sidebar-content {
                    padding: 0 15px;
                    overflow: visible;
                }
            
                .menu-items-container {
                    overflow: visible;
                }
            
                .main-content {
                    margin-left: 0;
                    padding: 15px;
                    width: 100%;
                }
            
                .stats-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
            
                .mood-grid {
                    grid-template-columns: repeat(3, 1fr);
                }
            }
        
            @media (max-width: 480px) {
                .stats-grid {
                    grid-template-columns: 1fr;
                }
            
                .mood-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
            
                .brand-name {
                    font-size: 20px;
                }
            
                .menu-item {
                    padding: 8px 10px;
                    font-size: 12px;
                }
            
                .menu-text {
                    font-size: 13px;
                    flex: 1;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    display: -webkit-box;
                    display: -moz-box;
                    display: box;
                    -webkit-line-clamp: 2;
                    -moz-line-clamp: 2;
                    line-clamp: 2;
                    -webkit-box-orient: vertical;
                    -moz-box-orient: vertical;
                    box-orient: vertical;
                    line-height: 1.4;
                    white-space: normal;
                    word-wrap: break-word;
                    max-height: 36px;
                }
            
                .page-title {
                    font-size: 22px;
                }
            
                .section-title {
                    font-size: 18px;
                }
            }
            </style>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        </head>
        
        <body>
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-content">
                    <!-- Brand Section -->
                    <div class="brand-section">
                        <div class="brand-icon">
                            <img src="Logo Depression Web.png" alt="Depresychology Logo" class="brand-logo-img">
                        </div>
                        <div class="brand-name">Depresychology</div>
                        <div class="brand-tagline">Assessment Psikologis Online</div>
                    </div>
            
                    <!-- User Section -->
                    <div class="user-section">
                        <div class="user-card">
                            <div class="user-name" id="sidebar-user-name">
                                <span id="user-full-name">Loading...</span>
                            </div>

                            <div class="user-status">
                                <span>Online</span>
                            </div>
                    
                            <div class="user-details">
                                <div class="detail-item">
                                    <div class="detail-icon">üìß</div>
                                    <span id="user-email">Loading...</span>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-icon">üë§</div>
                                    <span id="user-gender">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Menu Section -->
                    <div class="menu-section">
                        <div class="menu-title">MENU UTAMA</div>
                
                        <div class="menu-items-container">
                            <a href="dashboard.html" class="menu-item active" onclick="setActiveMenu('dashboard')">
                                <div class="menu-checkbox checked"></div>
                                <div class="menu-icon">üè†</div>
                                <div class="menu-text">Dashboard</div>
                            </a>
                    
                            <a href="dataset.html" class="menu-item active" onclick="setActiveMenu('dashboard')">
                                <div class="menu-checkbox checked"></div>
                                <div class="menu-icon">üóÉÔ∏è</div>
                                <div class="menu-text">Psychological Assessment Dataset</div>
                            </a>
                    
                            <a href="analisa.html" class="menu-item active" onclick="setActiveMenu('dashboard')">
                                <div class="menu-checkbox checked"></div>
                                <div class="menu-icon">üî¨</div>
                                <div class="menu-text">Analisa Psychological Assessment Dataset</div>
                            </a>
                    
                            <a href="tentang.html" class="menu-item" onclick="trackActivity('Pengaturan', '‚öôÔ∏è', 'pengaturan')">
                                <div class="menu-checkbox unchecked"></div>
                                <div class="menu-icon">üí≠</div>
                                <div class="menu-text">Tentang website</div>
                            </a>
                        </div>
                    </div>
            
                    <!-- Logout Section -->
                    <div class="logout-section">
                        <a href="index.html" class="logout-menu-item" onclick="return confirmLogout()">
                            <div class="logout-menu-checkbox unchecked"></div>
                            <div class="logout-menu-icon">üö™</div>
                            <div class="logout-menu-text">Keluar</div>
                        </a>
                    </div>
                </div>
            </div>
    
            <!-- Main Content -->
            <div class="main-content">
                <!-- Header -->
                <div class="header">
                    <h1 class="page-title">
                        <span class="page-icon">üè†</span>
                        Dashboard Depresychology
                    </h1>
                </div>
        
                <!-- Welcome Section -->
                <div class="welcome-section">
                    <h2 class="welcome-title" id="welcome-greeting">Selamat Datang! üëã</h2>
                    <p class="welcome-message">
                        Hari ini adalah hari yang baik untuk memantau kesehatan mental Anda.
                        Pantau perkembangan, lakukan assessment, dan lihat insight yang telah kami siapkan untuk Anda.
                    </p>
                </div>
            </div>
        
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total Tes Diselesaikan</div>
                        <div class="stat-icon">üìã</div>
                    </div>
                    <div class="stat-value" id="total-tests">0</div>
                    <div class="stat-trend" id="test-trend">Mulai tes pertama</div>
                </div>
            
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Skor Terakhir</div>
                        <div class="stat-icon">‚≠ê</div>
                    </div>
                    <div class="stat-value" id="last-score">-</div>
                    <div class="stat-trend" id="score-trend">Belum ada tes</div>
                </div>
            
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Mood Hari Ini</div>
                        <div class="stat-icon">üòä</div>
                    </div>
                    <div class="stat-value" id="today-mood">Belum diisi</div>
                    <div class="stat-trend">Pilih mood Anda</div>
                </div>
            
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Hari Berturut-turut</div>
                        <div class="stat-icon">üî•</div>
                    </div>
                    <div class="stat-value" id="streak-days">1</div>
                    <div class="stat-trend">Pantau terus!</div>
                </div>
            </div>
        
            <!-- Mood Tracker -->
            <div class="mood-tracker">
                <h3 class="section-title">
                    <span class="section-icon">ü§†</span>
                    Bagaimana Perasaan Anda Hari Ini?
                </h3>
            
                <div class="mood-grid">
                    <div class="mood-option" data-mood="sangat-baik">
                        <div class="mood-emoji">üòä</div>
                        <div class="mood-label">Sangat Baik</div>
                    </div>
                
                    <div class="mood-option" data-mood="baik">
                        <div class="mood-emoji">üôÇ</div>
                        <div class="mood-label">Baik</div>
                    </div>
                
                    <div class="mood-option" data-mood="biasa">
                        <div class="mood-emoji">üòê</div>
                        <div class="mood-label">Biasa Saja</div>
                    </div>
                
                    <div class="mood-option" data-mood="sedih">
                        <div class="mood-emoji">üòî</div>
                        <div class="mood-label">Sedih</div>
                    </div>

                    <div class="mood-option" data-mood="lelah">
                        <div class="mood-emoji">üò≠</div>
                        <div class="mood-label">Nangis</div>
                    </div>
                
                    <div class="mood-option" data-mood="cemas">
                        <div class="mood-emoji">üò∞</div>
                        <div class="mood-label">Cemas</div>
                    </div>
                
                    <div class="mood-option" data-mood="lelah">
                        <div class="mood-emoji">üò´</div>
                        <div class="mood-label">Lelah</div>
                    </div>

                    <div class="mood-option" data-mood="lelah">
                        <div class="mood-emoji">üò°</div>
                        <div class="mood-label">Marah</div>
                    </div>
                </div>
            </div>
            
            <!-- Activity History -->
            <div class="activity-history">
                <h3 class="section-title">
                    <span class="section-icon">üìã</span>
                    Aktivitas Terbaru
                </h3>
            
                <div class="history-list" id="history-list">
                    <!-- Activity history items will be loaded by JavaScript -->
                </div>
            </div>
        
            <!-- Footer -->
            <div class="footer">
                <div class="footer-logo">Depresychology</div>
                <div class="copyright">¬© 2026 Depresychology - Platform Kesehatan Mental. Hak cipta dilindungi undang-undang.</div>
            </div>
        </div>
        
        <script>
            function checkUserLogin() { // Check if user is logged in
                try {
                    const sessionUser = sessionStorage.getItem('currentUser');
                    const localUser = localStorage.getItem('currentUser');
                
                    if (!sessionUser && !localUser) {
                        window.location.href = 'index.html';
                        return false;
                    }
                    return true;
                } catch (error) {
                    window.location.href = 'index.html';
                    return false;
                }
            }
            
            function loadUserData() { // Load user data from localStorage
                try { // Try to get user data from sessionStorage first, then localStorage
                    let userData = sessionStorage.getItem('currentUser');
                    if (!userData) {
                        userData = localStorage.getItem('currentUser');
                    }
                
                    if (userData) {
                        const user = JSON.parse(userData);
                    
                        // Get user information
                        const fullName = user.fullName || user.name || 'Pengguna';
                        const email = user.email || 'user@example.com';
                        const gender = user.gender || 'Tidak ditentukan';
                    
                        // Format gender display
                        let genderDisplay = gender;
                        if (gender.toLowerCase() === 'female') {
                            genderDisplay = 'Perempuan';
                        } else if (gender.toLowerCase() === 'male') {
                            genderDisplay = 'Laki-laki';
                        }
                    
                        // Update sidebar
                        document.getElementById('user-full-name').textContent = fullName;
                        document.getElementById('user-email').textContent = email;
                        document.getElementById('user-gender').textContent = genderDisplay;
                    
                        // Return user data for welcome message
                        return { fullName, email, gender: genderDisplay };
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
                
                return null;
            }
        
            // Update welcome message with user's name
            function updateWelcomeMessage(userData) {
                const hour = new Date().getHours();
                let greeting = '';
                if (hour < 12) greeting = 'Pagi';
                else if (hour < 15) greeting = 'Siang';
                else if (hour < 18) greeting = 'Sore';
                else greeting = 'Malam';
            
                const welcomeTitle = document.getElementById('welcome-greeting');
                if (welcomeTitle && userData && userData.fullName) {
                    welcomeTitle.innerHTML = `Selamat ${greeting}, ${userData.fullName}! üëã`;
                } else if (welcomeTitle) {
                    welcomeTitle.innerHTML = `Selamat ${greeting}! üëã`;
                }
            }
        
            // Function to track user activity
            function trackActivity(pageName, icon, pageType) {
                const activity = {
                    id: Date.now(),
                    pageName: pageName,
                    icon: icon,
                    pageType: pageType,
                    timestamp: new Date().toISOString(),
                    timeDisplay: formatTime(new Date())
                };
                
                saveActivity(activity); // Save activity to localStorage
                setActiveMenu(pageType); // Update menu active state
                
                return true; // Continue to the page
            }
        
            // Format time for display
            function formatTime(date) {
                const now = new Date();
                const activityDate = new Date(date);
                const diffMs = now - activityDate;
                const diffMins = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
                if (diffMins < 1) {
                    return 'Baru saja';
                } else if (diffMins < 60) {
                    return `${diffMins} menit yang lalu`;
                } else if (diffHours < 24) {
                    return `${diffHours} jam yang lalu`;
                } else if (diffDays === 1) {
                    return 'Kemarin';
                } else if (diffDays < 7) {
                    return `${diffDays} hari yang lalu`;
                } else {
                    return activityDate.toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric'
                    });
                }
            }
        
            // Save activity to localStorage
            function saveActivity(activity) {
                try { // Get current user
                    let userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                    if (!userData) return;
                
                    const user = JSON.parse(userData);
                    const userId = user.email || user.id || 'anonymous';
                
                    // Get existing activities
                    const storageKey = `user_activities_${userId}`;
                    let activities = JSON.parse(localStorage.getItem(storageKey)) || [];

                    activities.unshift(activity); // Add new activity at the beginning
                
                    // Keep only last 20 activities
                    if (activities.length > 20) {
                        activities = activities.slice(0, 20);
                    }
                
                    // Save back to localStorage
                    localStorage.setItem(storageKey, JSON.stringify(activities));
                
                    // Update dashboard display if we're on dashboard
                    if (window.location.pathname.includes('dashboard.html')) {
                        loadActivityHistory();
                        updateActivityStats();
                    }
            
                } catch (error) {
                    console.error('Error saving activity:', error);
                }
            }
        
            // Load activity history
            function loadActivityHistory() {
                try { // Get current user
                    let userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                    if (!userData) return;
                    
                    const user = JSON.parse(userData);
                    const userId = user.email || user.id || 'anonymous';
                    
                    // Get activities from localStorage
                    const storageKey = `user_activities_${userId}`;
                    const activities = JSON.parse(localStorage.getItem(storageKey)) || [];
                    
                    const historyList = document.getElementById('history-list');
                    if (!historyList) return;
                    
                    if (activities.length === 0) {
                        historyList.innerHTML = `
                        <div class="empty-history">
                            <i class="fas fa-history"></i>
                            <p>Belum ada riwayat aktivitas</p>
                            <p style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                                Mulai jelajahi website untuk melihat riwayat di sini
                            </p>
                        </div>
                        `;
                        return;
                    }
                
                    // Map page types to descriptions
                    const pageDescriptions = {
                        'dashboard': 'Membuka Dashboard',
                        'tes': 'Mengikuti Tes Psikologis',
                        'hasil': 'Melihat Hasil Tes',
                        'riwayat': 'Melihat Riwayat',
                        'konseling': 'Konseling Online',
                        'artikel': 'Membaca Artikel',
                        'pengaturan': 'Mengubah Pengaturan',
                        'mood': 'Mencatat Mood'
                    };
                    
                    historyList.innerHTML = activities.map(activity => {
                        const description = pageDescriptions[activity.pageType] || `Membuka ${activity.pageName}`;
                        const formattedTime = formatTime(new Date(activity.timestamp));
                    
                        // Special case for mood activity
                        if (activity.pageType === 'mood' && activity.mood) {
                            return `
                            <div class="history-item">
                                <div class="history-icon">${activity.icon}</div>
                                <div class="history-content">
                                    <div class="history-title">Mencatat mood: ${activity.mood}</div>
                                    <div class="history-time">${formattedTime}</div>
                                </div>
                            </div>
                            `;
                        }
                    
                        return `
                        <div class="history-item">
                            <div class="history-icon">${activity.icon}</div>
                            <div class="history-content">
                                <div class="history-title">${description}</div>
                                <div class="history-time">${formattedTime}</div>
                            </div>
                        </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Error loading activity history:', error);
                }
            }
        
            // Get current user ID
            function getCurrentUserId() {
                try {
                    let userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                    if (userData) {
                        const user = JSON.parse(userData);
                        return user.email || user.id || 'anonymous';
                    }
                } catch (error) {
                    console.error('Error getting user ID:', error);
                }
                return 'anonymous';
            }
        
            // Load user statistics
            function loadUserStatistics() {
                try {
                    const userId = getCurrentUserId(); // Get test results for this user
                    const storageKey = `user_test_results_${userId}`;
                    const results = JSON.parse(localStorage.getItem(storageKey)) || [];
                
                    document.getElementById('total-tests').textContent = results.length; // Update test count
                
                    if (results.length === 0) {
                        document.getElementById('test-trend').textContent = 'Mulai tes pertama';
                        document.getElementById('test-trend').classList.add('stat-trend');
                    } else if (results.length === 1) {
                        document.getElementById('test-trend').textContent = 'Tes pertama selesai';
                        document.getElementById('test-trend').classList.add('stat-trend');
                    } else {
                        const lastWeekTests = results.filter(result => {
                            const resultDate = new Date(result.timestamp);
                            const oneWeekAgo = new Date();
                            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                            return resultDate > oneWeekAgo;
                        }).length;
                    
                        if (lastWeekTests > 0) {
                            document.getElementById('test-trend').textContent = `+${lastWeekTests} minggu ini`;
                            document.getElementById('test-trend').classList.remove('negative');
                            document.getElementById('test-trend').classList.add('stat-trend');
                        } else {
                            document.getElementById('test-trend').textContent = '0 minggu ini';
                            document.getElementById('test-trend').classList.add('stat-trend');
                        }
                    }
                
                    if (results.length > 0) { // Update last score
                        const lastResult = results[results.length - 1];
                        document.getElementById('last-score').textContent = lastResult.score || '-';
                    
                        if (results.length > 1) { // Calculate trend if there are previous results
                            const previousResult = results[results.length - 2];
                            const currentScore = parseFloat(lastResult.score) || 0;
                            const previousScore = parseFloat(previousResult.score) || 0;
                        
                            if (currentScore > previousScore) {
                                const improvement = (((currentScore - previousScore) / previousScore) * 100).toFixed(1);
                                document.getElementById('score-trend').textContent = `Meningkat ${improvement}%`;
                                document.getElementById('score-trend').classList.remove('negative');
                                document.getElementById('score-trend').classList.add('stat-trend');
                            } else if (currentScore < previousScore) {
                                const decline = (((previousScore - currentScore) / previousScore) * 100).toFixed(1);
                                document.getElementById('score-trend').textContent = `Menurun ${decline}%`;
                                document.getElementById('score-trend').classList.add('negative');
                            } else {
                                document.getElementById('score-trend').textContent = 'Stabil';
                                document.getElementById('score-trend').classList.remove('negative');
                                document.getElementById('score-trend').classList.add('stat-trend');
                            }
                        } else {
                            document.getElementById('score-trend').textContent = 'Tes pertama';
                            document.getElementById('score-trend').classList.remove('negative');
                            document.getElementById('score-trend').classList.add('stat-trend');
                        }
                    }
                } catch (error) {
                    console.error('Error loading user statistics:', error);
                }
            }
        
            function calculateStreak() { // Calculate streak days
                try {
                    const userId = getCurrentUserId();
                    const storageKey = `user_activities_${userId}`;
                    const activities = JSON.parse(localStorage.getItem(storageKey)) || [];
                
                    if (activities.length === 0) {
                        document.getElementById('streak-days').textContent = '1';
                        return;
                    }
                
                    const activityDays = new Set(); // Get unique days with activities
                    activities.forEach(activity => {
                        const date = new Date(activity.timestamp);
                        const dateString = date.toDateString();
                        activityDays.add(dateString);
                    });
                
                    const sortedDates = Array.from(activityDays).sort(); // Sort dates
                    let streak = 1; // Check for consecutive days
                    const today = new Date().toDateString();
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                
                    if (activityDays.has(today) || activityDays.has(yesterday.toDateString())) {
                        streak = 1;
                        for (let i = sortedDates.length - 1; i > 0; i--) { // Check backward for consecutive days
                            const currentDate = new Date(sortedDates[i]);
                            const prevDate = new Date(sortedDates[i-1]);
                            const diffTime = Math.abs(currentDate - prevDate);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                            if (diffDays === 1) {
                                streak++;
                            } else {
                                break;
                            }
                        }
                    }
                    document.getElementById('streak-days').textContent = streak;
                } catch (error) {
                    console.error('Error calculating streak:', error);
                }
            }
        
            function setupMoodTracker() { // Mood tracker functionality
                const moodOptions = document.querySelectorAll('.mood-option');
            
                moodOptions.forEach(option => {
                    option.addEventListener('click', function () { // Remove selected class from all options
                        moodOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected'); // Add selected class to clicked option

                        const mood = this.dataset.mood; // Get mood value
                        const moodLabels = {
                            'sangat-baik': 'Sangat Baik',
                            'baik': 'Baik',
                            'biasa': 'Biasa Saja',
                            'sedih': 'Sedih',
                            'cemas': 'Cemas',
                            'lelah': 'Lelah'
                        };
                    
                        document.getElementById('today-mood').textContent = moodLabels[mood]; // Update today's mood display

                        // Save to localStorage
                        const today = new Date().toDateString();
                        localStorage.setItem('mood_' + today, mood);
                    
                        showNotification('Mood Anda telah direkam: ' + moodLabels[mood]); // Show notification

                        const activity = { // Track mood selection as activity
                            id: Date.now(),
                            pageName: 'Mood Tracker',
                            icon: 'üòä',

                            pageType: 'mood',
                            timestamp: new Date().toISOString(),
                            timeDisplay: formatTime(new Date()),
                            mood: moodLabels[mood]
                        };
                        saveActivity(activity);
                    });
                });
            
                // Load today's mood if exists
                const today = new Date().toDateString();
                const savedMood = localStorage.getItem('mood_' + today);
                if (savedMood) {
                    const selectedOption = document.querySelector(`.mood-option[data-mood="${savedMood}"]`);
                    if (selectedOption) {
                        selectedOption.classList.add('selected');
                    
                        const moodLabels = {
                            'sangat-baik': 'Sangat Baik',
                            'baik': 'Baik',
                            'biasa': 'Biasa Saja',
                            'sedih': 'Sedih',
                            'cemas': 'Cemas',
                            'lelah': 'Lelah'
                        };
                        document.getElementById('today-mood').textContent = moodLabels[savedMood];
                    }
                }
            }
        
            // Show notification
            function showNotification(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--primary);
                color: white;
                padding: 10px 16px;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                font-size: 13px;
                max-width: 300px;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
            
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            
                // Add CSS for animations if not already present
                if (!document.getElementById('notification-animations')) {
                    const style = document.createElement('style');
                    style.id = 'notification-animations';
                    style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateY(100%); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateY(0); opacity: 1; }
                        to { transform: translateY(100%); opacity: 0; }
                    }
                    `;
                    document.head.appendChild(style);
                }
            }
        
            // Menu functions
            function setActiveMenu(menuName) {
                const menuItems = document.querySelectorAll('.menu-item');
            
                menuItems.forEach(item => {
                    item.classList.remove('active');
                    const checkbox = item.querySelector('.menu-checkbox');
                    if (checkbox) {
                        checkbox.classList.remove('checked');
                        checkbox.classList.add('unchecked');
                    }
                });
            
                const activeMenuItem = document.querySelector(`[onclick*="${menuName}"]`);
                if (activeMenuItem) {
                    activeMenuItem.classList.add('active');
                    const checkbox = activeMenuItem.querySelector('.menu-checkbox');
                    if (checkbox) {
                        checkbox.classList.remove('unchecked');
                        checkbox.classList.add('checked');
                    }
                }
            }
        
            function confirmLogout() {
                if (confirm('Apakah Anda yakin ingin keluar?')) {
                    sessionStorage.removeItem('currentUser');
                    localStorage.removeItem('currentUser');
                    return true;
                }
                return false;
            }
        
            function updateActivityStats() { // Update activity statistics
                try {
                    let userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser'); // Get current user
                    if (!userData) return;
                
                    const user = JSON.parse(userData);
                    const userId = user.email || user.id || 'anonymous';
                    
                    // Get activities from localStorage
                    const storageKey = `user_activities_${userId}`;
                    const activities = JSON.parse(localStorage.getItem(storageKey)) || [];

                    // Count today's activities
                    const today = new Date().toDateString();
                    const todayActivities = activities.filter(activity => {
                        const activityDate = new Date(activity.timestamp).toDateString();
                        return activityDate === today;
                    });
                    
                    // Update stats
                    const totalActivitiesElement = document.getElementById('total-activities');
                    if (totalActivitiesElement) {
                        totalActivitiesElement.textContent = todayActivities.length;
                    }
                
                } catch (error) {
                    console.error('Error updating activity stats:', error);
                }
            }
        
            // Initialize the dashboard
            document.addEventListener('DOMContentLoaded', function () {
                if (!checkUserLogin()) {
                    return;
                }
            
                // Load user data and update UI
                const userData = loadUserData();
                updateWelcomeMessage(userData);

                // Load user-specific data
                loadUserStatistics();
                loadActivityHistory();
                setupMoodTracker();
                calculateStreak();
                setActiveMenu('dashboard');
            
                // Track dashboard access
                const dashboardActivity = {
                    id: Date.now(),
                    pageName: 'Dashboard',
                    icon: 'üè†',
                    pageType: 'dashboard',
                    timestamp: new Date().toISOString(),
                    timeDisplay: formatTime(new Date())
                };
                saveActivity(dashboardActivity);
            });
            </script>
    </body>
</html>
