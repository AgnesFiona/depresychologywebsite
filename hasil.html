<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Hasil Tes - Depresychology</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
        
            :root {
                --primary: #667eea;
                --primary-dark: #5a67d8;
                --secondary: #764ba2;
                --light: #f8fafc;
                --dark: #2d3748;
                --gray: #718096;
                --border: #e2e8f0;
                --success: #48bb78;
                --warning: #ed8936;
                --danger: #f56565;
                --info: #4299e1;
                --sidebar-width: 280px;
            }
        
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                color: var(--dark);
                background: #f5f7fa;
                min-height: 100vh;
                display: flex;
                overflow-x: hidden;
            }
        
            /* SIDEBAR */
            .sidebar {
                width: var(--sidebar-width);
                background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
                color: white;
                padding: 20px 0;
                height: 100vh;
                position: fixed;
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
                display: flex;
                flex-direction: column;
                overflow: hidden;
                z-index: 1000;
            }

            .sidebar-content {
                padding: 0 15px;
                flex: 1;
                display: flex;
                flex-direction: column;
                height: 100%;
                overflow: hidden;
            }

            .brand-section {
                margin-bottom: 25px;
                text-align: center;
                padding: 0 10px;
                flex-shrink: 0;
            }

            .brand-icon {
                width: 60px;
                height: 60px;
                margin: 0 auto 12px auto;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.2);
            }

            .brand-logo-img {
                width: 50px;
                height: 50px;
                object-fit: contain;
            }

            .brand-name {
                font-size: 22px;
                font-weight: 700;
                margin-bottom: 3px;
            }

            .brand-tagline {
                font-size: 12px;
                opacity: 0.9;
                letter-spacing: 0.5px;
                white-space: nowrap;
            }

            .user-section {
                margin-bottom: 25px;
                flex-shrink: 0;
            }

            .user-card {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                padding: 15px;
                backdrop-filter: blur(10px);
            }

            .user-name {
                display: flex;
                justify-content: center;
                gap: 6px;
                margin-bottom: 10px;
                font-size: 16px;
                font-weight: 600;
                white-space: nowrap;
            }

            .user-status {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-bottom: 15px;
                font-size: 13px;
            }

            .user-details {
                background: rgba(255, 255, 255, 0.08);
                border-radius: 8px;
                padding: 12px;
            }

            .detail-item {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 8px;
                font-size: 12px;
            }

            .detail-item:last-child {
                margin-bottom: 0;
            }

            .detail-item .detail-icon {
                width: 14px;
                text-align: center;
                flex-shrink: 0;
            }

            .detail-item span {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex: 1;
            }

            .menu-checkbox {
                width: 14px;
                height: 14px;
                border: 2px solid rgba(255, 255, 255, 0.5);
                border-radius: 3px;
                margin-right: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }

            .menu-checkbox.checked::after {
                content: '‚úì';
                font-size: 10px;
                color: white;
            }

            .menu-checkbox.unchecked {
                background: rgba(255, 255, 255, 0.1);
            }

            .menu-section {
                margin-bottom: 15px;
                flex: 1;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }

            .menu-title {
                font-size: 11px;
                text-transform: uppercase;
                letter-spacing: 0.8px;
                margin: 0 0 12px 8px;
                opacity: 0.7;
                font-weight: 600;
                white-space: nowrap;
                flex-shrink: 0;
            }

            .menu-items-container {
                flex: 1;
                overflow-y: auto;
                overflow-x: hidden;
                scrollbar-width: none;
                -ms-overflow-style: none;
                padding-right: 3px;
            }

            .menu-items-container::-webkit-scrollbar {
                display: none;
            }

            .menu-item {
                display: flex;
                align-items: center;
                padding: 10px 12px;
                border-radius: 8px;
                margin-bottom: 6px;
                transition: all 0.2s ease;
                cursor: pointer;
                text-decoration: none;
                color: white;
                font-size: 13px;
                min-width: 0;
                flex-shrink: 0;
            }

            .menu-item:hover {
                background: rgba(255, 255, 255, 0.15);
                transform: translateX(3px);
            }

            .menu-item.active {
                background: rgba(255, 255, 255, 0.2);
                font-weight: 600;
            }

            .menu-item.active .menu-checkbox {
                border-color: white;
            }

            .menu-item.active .menu-checkbox.unchecked::after {
                content: '‚úì';
                font-size: 10px;
                color: white;
            }

            .menu-icon {
                font-size: 14px;
                margin-right: 10px;
                width: 18px;
                text-align: center;
                flex-shrink: 0;
            }

            .menu-text {
                font-size: 13px;
                flex: 1;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                line-height: 1.4;
                white-space: normal;
                word-wrap: break-word;
                max-height: 36px;
                line-clamp: 2;
                box-orient: vertical;
            }

            .logout-section {
                margin-top: auto;
                padding: 10px 0;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                flex-shrink: 0;
            }

            .logout-menu-item {
                display: flex;
                align-items: center;
                padding: 10px 12px;
                border-radius: 8px;
                transition: all 0.2s ease;
                cursor: pointer;
                text-decoration: none;
                color: #fed7d7;
                background: rgba(245, 101, 101, 0.15);
                border: 1px solid rgba(245, 101, 101, 0.3);
                font-size: 13px;
            }

            .logout-menu-item:hover {
                background: rgba(245, 101, 101, 0.25);
                transform: translateX(3px);
                color: #fff5f5;
                border-color: rgba(245, 101, 101, 0.5);
            }

            .logout-menu-icon {
                font-size: 14px;
                margin-right: 10px;
                width: 18px;
                text-align: center;
                flex-shrink: 0;
            }

            .logout-menu-text {
                font-size: 13px;
                flex: 1;
                font-weight: 600;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .logout-menu-checkbox {
                width: 14px;
                height: 14px;
                border: 2px solid rgba(245, 101, 101, 0.5);
                border-radius: 3px;
                margin-right: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(245, 101, 101, 0.1);
                flex-shrink: 0;
            }

            .logout-menu-checkbox.unchecked::after {
                content: 'üö™';
                font-size: 9px;
                color: #fed7d7;
            }
        
            /* Main Content */
            .main-content {
                flex: 1;
                margin-left: var(--sidebar-width);
                padding: 30px;
                min-height: 100vh;
                overflow-y: auto;
                padding-bottom: 50px;
                width: calc(100% - var(--sidebar-width));
            }
        
            .header {
                margin-bottom: 30px;
            }
        
            .page-title {
                font-size: 28px;
                font-weight: 700;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 12px;
            }
        
            .page-icon {
                font-size: 24px;
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
            }
        
            /* Recent Results */
            .recent-results {
                background: white;
                border-radius: 16px;
                padding: 30px;
                margin-bottom: 30px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
        
            .section-title {
                font-size: 22px;
                font-weight: 700;
                margin-bottom: 25px;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 12px;
            }
        
            .section-icon {
                color: var(--primary);
            }
        
            /* Results Summary */
            .results-summary {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 25px;
                margin-bottom: 30px;
            }
        
            .summary-card {
                background: var(--light);
                border-radius: 12px;
                padding: 25px;
                text-align: center;
                border: 1px solid var(--border);
            }
        
            .summary-icon {
                font-size: 32px;
                margin-bottom: 15px;
            }
        
            .summary-title {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 10px;
                color: var(--dark);
            }
        
            .summary-value {
                font-size: 28px;
                font-weight: 700;
                margin-bottom: 5px;
            }
        
            .summary-trend {
                font-size: 14px;
                color: var(--success);
            }
        
            .summary-trend.negative {
                color: var(--danger);
            }
        
            /* Results Table */
            .results-table-container {
                background: white;
                border-radius: 16px;
                padding: 25px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
                overflow-x: auto;
                margin-bottom: 40px;
            }
        
            .table-title {
                font-size: 20px;
                font-weight: 700;
                margin-bottom: 20px;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 10px;
            }
        
            .table-title-icon {
                color: var(--primary);
            }
        
            .results-table {
                width: 100%;
                border-collapse: collapse;
                min-width: 800px;
            }
        
            .results-table th {
                background: var(--light);
                padding: 16px 20px;
                text-align: left;
                font-weight: 600;
                color: var(--dark);
                border-bottom: 2px solid var(--border);
                font-size: 14px;
                white-space: nowrap;
            }
        
            .results-table td {
                padding: 14px 20px;
                border-bottom: 1px solid var(--border);
                font-size: 14px;
                color: var(--gray);
            }
        
            .results-table tr:hover {
                background: rgba(102, 126, 234, 0.05);
            }
        
            /* Badge untuk status */
            .badge {
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                display: inline-block;
            }
        
            .badge-success {
                background: #c6f6d5;
                color: #276749;
            }
        
            .badge-warning {
                background: #feebc8;
                color: #975a16;
            }
        
            .badge-danger {
                background: #fed7d7;
                color: #9b2c2c;
            }
        
            .badge-info {
                background: #c3dafe;
                color: #2c5282;
            }
        
            /* Action buttons */
            .action-buttons {
                display: flex;
                gap: 10px;
            }
        
            .action-btn {
                padding: 6px 12px;
                border: none;
                border-radius: 6px;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
        
            .action-btn.view {
                background: var(--info);
                color: white;
            }
            
            .action-btn.download {
                background: var(--success);
                color: white;
            }
        
            .action-btn.delete {
                background: var(--danger);
                color: white;
            }
        
            .action-btn:hover {
                opacity: 0.9;
            }
        
            /* Detailed Result View */
            .detailed-result {
                background: white;
                border-radius: 16px;
                padding: 30px;
                margin-bottom: 40px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
                display: none;
            }
        
            .detailed-result.active {
                display: block;
            }
        
            .result-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
            }
            
            .result-title {
                font-size: 24px;
                font-weight: 700;
                color: var(--dark);
            }
        
            .result-date {
                font-size: 14px;
                color: var(--gray);
                background: var(--light);
                padding: 8px 16px;
                border-radius: 20px;
            }
        
            /* Score Display */
            .score-display {
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                border-radius: 16px;
                padding: 30px;
                color: white;
                text-align: center;
                margin-bottom: 30px;
            }
            
            .score-value {
                font-size: 48px;
                font-weight: 700;
                margin-bottom: 10px;
            }
        
            .score-label {
                font-size: 18px;
                opacity: 0.9;
            }
        
            /* Questions Review */
            .questions-review {
                margin-bottom: 30px;
            }
        
            .review-title {
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 20px;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 10px;
            }
        
            .review-title-icon {
                color: var(--primary);
            }
        
            .question-review-item {
                background: var(--light);
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid var(--border);
            }
        
            .question-text {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 15px;
                color: var(--dark);
            }
        
            .answer-container {
                display: flex;
                align-items: center;
                gap: 15px;
            }
        
            .answer-value {
                font-size: 14px;
                color: var(--gray);
            }
        
            .answer-score {
                font-size: 14px;
                font-weight: 600;
                padding: 4px 12px;
                border-radius: 20px;
                background: white;
            }
        
            .interpretation {
                background: var(--light);
                border-radius: 12px;
                padding: 25px;
                margin-bottom: 25px;
            }
        
            .interpretation-title {
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 15px;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 10px;
            }
        
            .interpretation-content {
                font-size: 16px;
                line-height: 1.6;
                color: var(--gray);
            }
    
            .recommendations {
                background: rgba(72, 187, 120, 0.1);
                border-radius: 12px;
                padding: 25px;
                border-left: 4px solid var(--success);
            }
        
            .recommendations-title {
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 15px;
                color: #276749;
                display: flex;
                align-items: center;
                gap: 10px;
            }
        
            .recommendations-list {
                list-style: none;
            }
        
            .recommendations-list li {
                margin-bottom: 10px;
                padding-left: 25px;
                position: relative;
                font-size: 16px;
                color: #276749;
            }
        
            .recommendations-list li:before {
                content: '‚úì';
                position: absolute;
                left: 0;
                color: var(--success);
                font-weight: bold;
            }
        
            /* No Results Message */
            .no-results {
                text-align: center;
                padding: 60px 20px;
                color: var(--gray);
            }
        
            .no-results-icon {
                font-size: 64px;
                margin-bottom: 20px;
                opacity: 0.5;
            }
        
            .no-results-title {
                font-size: 24px;
                font-weight: 600;
                margin-bottom: 15px;
                color: var(--dark);
            }
        
            .no-results-description {
                font-size: 16px;
                margin-bottom: 30px;
                max-width: 500px;
                margin-left: auto;
                margin-right: auto;
                line-height: 1.6;
            }
        
            .no-results-button {
                padding: 14px 32px;
                background: var(--primary);
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
        
            .no-results-button:hover {
                background: var(--primary-dark);
            }
        
            .footer {
                text-align: center;
                padding: 30px 20px 20px;
                color: var(--gray);
                margin-top: 40px;
                border-top: 1px solid var(--border);
            }
        
            .footer-logo {
                font-size: 20px;
                font-weight: 700;
                color: var(--primary);
                margin-bottom: 8px;
            }
        
            .copyright {
                font-size: 14px;
                opacity: 0.8;
            }
        
            /* Responsive */
            @media (max-width: 1024px) {
                :root {
                    --sidebar-width: 240px;
                }
            
                .main-content {
                    padding: 25px;
                }
            
                .menu-text {
                    font-size: 12px;
                }
            }
        
            @media (max-width: 768px) {
                body {
                    flex-direction: column;
                }
            
                .sidebar {
                    width: 100%;
                    height: auto;
                    position: relative;
                    padding: 15px 0;
                    max-height: 70vh;
                    overflow-y: auto;
                }
            
                .sidebar-content {
                    padding: 0 15px;
                    overflow: visible;
                }
            
                .menu-items-container {
                    overflow: visible;
                }
            
                .main-content {
                    margin-left: 0;
                    padding: 20px;
                }
            
                .results-summary {
                    grid-template-columns: repeat(2, 1fr);
                }
            
                .action-buttons {
                    flex-direction: column;
                    gap: 5px;
                }
            
                .action-btn {
                    width: 100%;
                    text-align: center;
                }
            }
        
            @media (max-width: 480px) {
                .results-summary {
                    grid-template-columns: 1fr;
                }
                
                .summary-value {
                    font-size: 24px;
                }
            
                .menu-text {
                    font-size: 13px;
                    flex: 1;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    display: -webkit-box;
                    display: -moz-box;
                    display: box;
                    -webkit-line-clamp: 2;
                    -moz-line-clamp: 2;
                    line-clamp: 2;
                    -webkit-box-orient: vertical;
                    -moz-box-orient: vertical;
                    box-orient: vertical;
                    line-height: 1.4;
                    white-space: normal;
                    word-wrap: break-word;
                    max-height: 36px;
                }
            
                .brand-name {
                    font-size: 20px;
                }
            
                .page-title {
                    font-size: 22px;
                }
            }
        </style>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
    <body>
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-content">
                <!-- Brand Section -->
                <div class="brand-section">
                    <div class="brand-icon">
                        <img src="Logo Depression Web.png" alt="Depresychology Logo" class="brand-logo-img">
                    </div>
                    <div class="brand-name">Depresychology</div>
                    <div class="brand-tagline">Assessment Psikologis Online</div>
                </div>

                <!-- User Section -->
                <div class="user-section">
                    <div class="user-card">
                        <div class="user-name" id="sidebar-user-name">
                            <span id="user-full-name">Loading...</span>
                        </div>

                        <div class="user-status">
                            <span>Online</span>
                        </div>

                        <div class="user-details">
                            <div class="detail-item">
                                <div class="detail-icon">üìß</div>
                                <span id="user-email">Loading...</span>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">üë§</div>
                                <span id="user-gender">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Menu Section -->
                <div class="menu-section">
                    <div class="menu-title">MENU UTAMA</div>

                    <div class="menu-items-container">
                        <a href="dashboard.html" class="menu-item" onclick="setActiveMenu('dashboard')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üè†</div>
                            <div class="menu-text">Dashboard</div>
                        </a>

                        <a href="dataset.html" class="menu-item" onclick="setActiveMenu('dataset')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üóÉÔ∏è</div>
                            <div class="menu-text">Psychological Assessment Dataset</div>
                        </a>

                        <a href="analisa.html" class="menu-item" onclick="setActiveMenu('analisa')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üî¨</div>
                            <div class="menu-text">Analisa Psychological Assessment Dataset</div>
                        </a>

                        <a href="input.html" class="menu-item" onclick="setActiveMenu('tes')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üß™</div>
                            <div class="menu-text">Tes Psikologis</div>
                        </a>

                        <a href="hasil.html" class="menu-item" onclick="trackActivity('Hasil Tes', 'üìä', 'hasil')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üìä</div>
                            <div class="menu-text">Hasil Tes Saya</div>
                        </a>

                        <a href="riwayat.html" class="menu-item" onclick="trackActivity('Riwayat', 'üìú', 'riwayat')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üìú</div>
                            <div class="menu-text">Riwayat Saya</div>
                        </a>

                        <a href="tentang.html" class="menu-item" onclick="trackActivity('Tentang Website', 'üí≠', 'tentang')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üí≠</div>
                            <div class="menu-text">Tentang website</div>
                        </a>
                    </div>
                </div>

                <!-- Logout Section -->
                <div class="logout-section">
                    <a href="index.html" class="logout-menu-item" onclick="return confirmLogout()">
                        <div class="logout-menu-checkbox unchecked"></div>
                        <div class="logout-menu-icon">üö™</div>
                        <div class="logout-menu-text">Keluar</div>
                    </a>
                </div>
            </div>
        </div>
    
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 class="page-title">
                    <span class="page-icon">üìä</span>
                    Hasil Tes Psikologis
                </h1>
            </div>
        
            <!-- Recent Results Summary -->
            <div class="recent-results">
                <h2 class="section-title">
                    <span class="section-icon">üìà</span>
                    Ringkasan Hasil Tes
                </h2>
                
                <div class="results-summary">
                    <div class="summary-card">
                        <div class="summary-icon">üìã</div>
                        <div class="summary-title">Total Tes Diselesaikan</div>
                        <div class="summary-value" id="total-tests">0</div>
                        <div class="summary-trend">+2 minggu ini</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-icon">üòä</div>
                        <div class="summary-title">Rata-rata Skor</div>
                        <div class="summary-value" id="average-score">0</div>
                        <div class="summary-trend">Membaik 10%</div>
                    </div>
                    
                    <div class="summary-card">
                            <div class="summary-icon">üéØ</div>
                        <div class="summary-title">Tes Terakhir</div>
                        <div class="summary-value" id="last-test-score">-</div>
                        <div class="summary-trend">Hari ini</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-icon">üìÖ</div>
                        <div class="summary-title">Aktivitas Bulan Ini</div>
                        <div class="summary-value" id="monthly-activity">0</div>
                        <div class="summary-trend">+3 dari bulan lalu</div>
                    </div>
                </div>
            </div>
            
            <!-- Results Table -->
            <div class="results-table-container">
                <h3 class="table-title">
                <span class="table-title-icon">üìã</span>
                    Riwayat Hasil Tes
                </h3>
            
                <div id="results-table-wrapper">
                    <!-- Table will be loaded here by JavaScript -->
                </div>
                
                <!-- No Results Message -->
                <div id="no-results-message" class="no-results" style="display: none;">
                    <div class="no-results-icon">üìä</div>
                    <h3 class="no-results-title">Belum Ada Hasil Tes</h3>
                    <p class="no-results-description">
                        Anda belum mengerjakan tes psikologis. Silakan klik tombol di bawah untuk mulai mengerjakan tes pertama Anda.
                    </p>
                    <button class="no-results-button" onclick="window.location.href='input.html'">
                        <i class="fas fa-play"></i> Mulai Tes Psikologis
                    </button>
                </div>
            </div>
            
            <!-- Detailed Result View -->
            <div id="detailed-result" class="detailed-result">
                <!-- Content will be loaded here by JavaScript -->
            </div>
        
            <!-- Footer -->
            <div class="footer">
                <div class="footer-logo">Depresychology</div>
                <div class="copyright">¬© 2024 Depresychology - Assessment Psikologis Online. Hak cipta dilindungi undang-undang.</div>
            </div>
        </div>

        <script>
            // Sample test data for demonstration
            const sampleTestResults = [
                {
                    id: 1,
                    testType: 'phq9',
                    testName: 'PHQ-9 (Depression Test)',
                    score: 7,
                    interpretation: 'Depresi Ringan',
                    date: '28 Des 2024, 14:30',
                    answers: {
                        1: 1, 2: 2, 3: 1, 4: 2, 5: 0, 6: 1, 7: 0, 8: 0, 9: 0
                    }
                },
                {
                    id: 2,
                    testType: 'gad7',
                    testName: 'GAD-7 (Anxiety Test)',
                    score: 10,
                    interpretation: 'Kecemasan Sedang',
                    date: '25 Des 2024, 10:15',
                    answers: {
                        1: 2, 2: 1, 3: 2, 4: 1, 5: 2, 6: 1, 7: 1
                    }
                },
                {
                    id: 3,
                    testType: 'phq9',
                    testName: 'PHQ-9 (Depression Test)',
                    score: 4,
                    interpretation: 'Minimal Depresi',
                    date: '20 Des 2024, 09:45',
                    answers: {
                        1: 0, 2: 1, 3: 1, 4: 1, 5: 0, 6: 0, 7: 1, 8: 0, 9: 0
                    }
                },
                {
                    id: 4,
                    testType: 'comprehensive',
                    testName: 'Comprehensive Assessment',
                    score: 15,
                    interpretation: 'Mixed Symptoms',
                    date: '15 Des 2024, 16:20',
                    answers: {
                        1: 2, 2: 2, 3: 3, 4: 2, 5: 2, 6: 1, 7: 2, 8: 1, 9: 2
                    }
                }
            ];
        
            // PHQ-9 questions for review
            const phq9Questions = [
                "Seberapa sering selama 2 minggu terakhir Anda merasa tidak berminat atau tidak senang melakukan berbagai hal?",
                "Seberapa sering selama 2 minggu terakhir Anda merasa sedih, murung, atau putus asa?",
                "Seberapa sering selama 2 minggu terakhir Anda sulit tidur atau terlalu banyak tidur?",
                "Seberapa sering selama 2 minggu terakhir Anda merasa lelah atau kehilangan energi?",
                "Seberapa sering selama 2 minggu terakhir Anda nafsu makan buruk atau makan berlebihan?",
                "Seberapa sering selama 2 minggu terakhir Anda merasa buruk tentang diri sendiri - atau bahwa Anda gagal atau mengecewakan diri sendiri atau keluarga?",
                "Seberapa sering selama 2 minggu terakhir Anda sulit berkonsentrasi pada sesuatu, seperti membaca koram atau menonton televisi?",
                "Seberapa sering selama 2 minggu terakhir Anda bergerak atau berbicara sangat lambat sehingga orang lain menyadarinya? Atau sebaliknya - sangat gelisah sehingga Anda bergerak jauh lebih banyak dari biasanya?",
                "Seberapa sering selama 2 minggu terakhir Anda berpikir lebih baik mati atau ingin menyakiti diri sendiri dengan cara tertentu?"
            ];
                
            // Get results from localStorage or use sample data
            function getTestResults() {
                const storedResults = localStorage.getItem('testResults');
                if (storedResults) {
                    return JSON.parse(storedResults);
                } else {
                    // Save sample data to localStorage for demonstration
                    localStorage.setItem('testResults', JSON.stringify(sampleTestResults));
                    return sampleTestResults;
                }
            }
        
            // Update summary statistics
            function updateSummaryStatistics() {
                const results = getTestResults();
                document.getElementById('total-tests').textContent = results.length;// Total tests
            
                // Average score
                if (results.length > 0) {
                    const totalScore = results.reduce((sum, result) => sum + result.score, 0);
                    const averageScore = (totalScore / results.length).toFixed(1);
                    document.getElementById('average-score').textContent = averageScore;
                }
            
                // Last test score
                if (results.length > 0) {
                    const lastTest = results[0];
                    document.getElementById('last-test-score').textContent = lastTest.score;
                }
            
                // Monthly activity (simplified)
                document.getElementById('monthly-activity').textContent = results.length;
            }
        
            // Render results table
            function renderResultsTable() {
                const results = getTestResults();
                const tableWrapper = document.getElementById('results-table-wrapper');
                const noResultsMessage = document.getElementById('no-results-message');
            
                if (results.length === 0) {
                    tableWrapper.innerHTML = '';
                    noResultsMessage.style.display = 'block';
                    return;
                }
            
                noResultsMessage.style.display = 'none';
            
                const tableHTML = `
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Jenis Tes</th>
                                <th>Skor</th>
                                <th>Interpretasi</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="results-table-body">
                            ${results.map(result => `
                                <tr data-result-id="${result.id}">
                                    <td>${result.date}</td>
                                    <td>${result.testName}</td>
                                    <td>
                                        <span class="badge ${
                                            result.score <= 4 ? 'badge-success' : 
                                            result.score <= 9 ? 'badge-warning' : 
                                            result.score <= 14 ? 'badge-danger' : 'badge-info'
                                        }">
                                            ${result.score}
                                        </span>
                                    </td>
                                    <td>${result.interpretation}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view" onclick="viewResult(${result.id})">
                                                <i class="fas fa-eye"></i> Lihat
                                            </button>
                                            <button class="action-btn download" onclick="downloadResult(${result.id})">
                                                <i class="fas fa-download"></i> Unduh
                                            </button>
                                            <button class="action-btn delete" onclick="deleteResult(${result.id})">
                                                <i class="fas fa-trash"></i> Hapus
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            
                tableWrapper.innerHTML = tableHTML;
            }
        
            // View detailed result
            function viewResult(resultId) {
                const results = getTestResults();
                const result = results.find(r => r.id === resultId);
                
                if (!result) return;
                
                // Get badge class based on score
                let badgeClass = 'badge-success';
                if (result.score <= 4) badgeClass = 'badge-success';
                else if (result.score <= 9) badgeClass = 'badge-warning';
                else if (result.score <= 14) badgeClass = 'badge-danger';
                else badgeClass = 'badge-info';
                
                // Get recommendations based on score
                let recommendations = [];
                if (result.score <= 4) {
                    recommendations = [
                        "Terus jaga pola hidup sehat",
                        "Pertahankan hubungan sosial yang positif",
                        "Lakukan aktivitas yang menyenangkan secara rutin"
                    ];
                } else if (result.score <= 9) {
                    recommendations = [
                        "Konsultasi dengan profesional jika gejala berlanjut",
                        "Tingkatkan aktivitas fisik",
                        "Praktikkan teknik relaksasi"
                    ];
                } else if (result.score <= 14) {
                    recommendations = [
                        "Konsultasi dengan psikolog/psikiater",
                        "Pertimbangkan terapi psikologis",
                        "Jaga rutinitas yang terstruktur"
                    ];
                } else {
                    recommendations = [
                        "Segera konsultasi dengan profesional",
                        "Pertimbangkan terapi medis",
                        "Dapatkan dukungan dari keluarga/teman"
                    ];
                }
            
                // Generate questions review HTML
                let questionsReviewHTML = '';
                if (result.testType === 'phq9') {
                    questionsReviewHTML = phq9Questions.map((question, index) => {
                        const answer = result.answers[index + 1] || 0;
                        const answerText = getAnswerText(answer);
                        return `
                            <div class="question-review-item">
                                <div class="question-text">${question}</div>
                                <div class="answer-container">
                                    <div class="answer-value">Jawaban: ${answerText}</div>
                                    <div class="answer-score">Skor: ${answer}</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    questionsReviewHTML = `
                        <div class="question-review-item">
                            <div class="question-text">Detail jawaban tidak tersedia untuk tes ini.</div>
                        </div>
                    `;
                }
            
                // Build detailed result HTML
                const detailedResultHTML = `
                <div class="result-header">
                    <h2 class="result-title">${result.testName}</h2>
                    <div class="result-date">${result.date}</div>
                </div>
                
                <div class="score-display">
                    <div class="score-value">${result.score}</div>
                    <div class="score-label">${result.interpretation}</div>
                </div>
                
                <div class="questions-review">
                    <h3 class="review-title">
                        <span class="review-title-icon">üìù</span>
                        Review Jawaban
                    </h3>
                    ${questionsReviewHTML}
                </div>
                
                <div class="interpretation">
                    <h3 class="interpretation-title">
                        <i class="fas fa-info-circle"></i> Interpretasi Hasil
                    </h3>
                    <div class="interpretation-content">
                        Skor Anda menunjukkan ${result.interpretation.toLowerCase()}. Hasil ini didasarkan pada respons Anda terhadap pertanyaan-pertanyaan dalam tes.
                    </div>
                </div>
                
                <div class="recommendations">
                    <h3 class="recommendations-title">
                        <i class="fas fa-lightbulb"></i> Rekomendasi
                    </h3>
                    <ul class="recommendations-list">
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="action-btn download" onclick="downloadResult(${result.id})" style="padding: 12px 24px; font-size: 14px;">
                        <i class="fas fa-download"></i> Unduh Laporan Lengkap
                    </button>
                    <button class="action-btn" onclick="hideDetailedResult()" style="padding: 12px 24px; font-size: 14px; 
                        background: var(--gray); color: white; margin-left: 10px;">
                        <i class="fas fa-times"></i> Tutup
                    </button>
                </div>
                `;
            
                // Show detailed result
                const detailedResultDiv = document.getElementById('detailed-result');
                detailedResultDiv.innerHTML = detailedResultHTML;
                detailedResultDiv.classList.add('active');
                
                detailedResultDiv.scrollIntoView({ behavior: 'smooth' }); // Scroll to detailed result
            }
        
            // Get answer text from value
            function getAnswerText(value) {
                switch(value) {
                    case 0: return "Tidak sama sekali";
                    case 1: return "Beberapa hari";
                    case 2: return "Lebih dari separuh waktu";
                    case 3: return "Hampir setiap hari";
                    default: return "Tidak dijawab";
                }
            }
        
            // Hide detailed result
            function hideDetailedResult() {
                const detailedResultDiv = document.getElementById('detailed-result');
                detailedResultDiv.classList.remove('active');
            }
        
            // Download result
            function downloadResult(resultId) {
                const results = getTestResults();
                const result = results.find(r => r.id === resultId);
            
                if (!result) return;
                
                // Create a simple text report
                const report = `
                    DEPRESYCHOLOGY - LAPORAN HASIL TES
                    ===================================

                    Jenis Tes: ${result.testName}
                    Tanggal: ${result.date}
                    Skor: ${result.score}
                    Interpretasi: ${result.interpretation}

                    RINGKASAN:
                    Skor Anda menunjukkan ${result.interpretation.toLowerCase()}. 
                    Hasil ini didasarkan pada respons Anda terhadap pertanyaan-pertanyaan dalam tes.

                    REKOMENDASI:
                    ${getRecommendations(result.score).map(rec => `‚Ä¢ ${rec}`).join('\n')}

                    ---
                    Catatan: Hasil tes ini hanya untuk tujuan informasi dan bukan diagnosis medis.
                    Konsultasikan dengan profesional kesehatan mental untuk diagnosis dan perawatan yang tepat.
                `;
            
                // Create download link
                const blob = new Blob([report], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Hasil_Tes_${result.testName.replace(/\s+/g, '_')}_${result.date.split(',')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('Laporan berhasil diunduh!');
            }
        
            // Get recommendations based on score
            function getRecommendations(score) {
                if (score <= 4) {
                    return [
                        "Terus jaga pola hidup sehat",
                        "Pertahankan hubungan sosial yang positif",
                        "Lakukan aktivitas yang menyenangkan secara rutin"
                    ];
                } else if (score <= 9) {
                    return [
                        "Konsultasi dengan profesional jika gejala berlanjut",
                        "Tingkatkan aktivitas fisik",
                        "Praktikkan teknik relaksasi"
                    ];
                } else if (score <= 14) {
                    return [
                        "Konsultasi dengan psikolog/psikiater",
                        "Pertimbangkan terapi psikologis",
                        "Jaga rutinitas yang terstruktur"
                    ];
                } else {
                    return [
                        "Segera konsultasi dengan profesional",
                        "Pertimbangkan terapi medis",
                        "Dapatkan dukungan dari keluarga/teman"
                    ];
                }
            }
        
            // Delete result
            function deleteResult(resultId) {
                if (!confirm('Apakah Anda yakin ingin menghapus hasil tes ini?')) {
                    return;
                }
            
                const results = getTestResults();
                const filteredResults = results.filter(r => r.id !== resultId);
                
                localStorage.setItem('testResults', JSON.stringify(filteredResults)); // Save to localStorage
            
                // Update UI
                updateSummaryStatistics();
                renderResultsTable();
                
                hideDetailedResult(); // Hide detailed result if it was showing
            
                alert('Hasil tes berhasil dihapus!');
            }
        
            // Menu functions
            function setActiveMenu(menuName) {
                const menuItems = document.querySelectorAll('.menu-item');
            
                menuItems.forEach(item => {
                    item.classList.remove('active');
                    const checkbox = item.querySelector('.menu-checkbox');
                    checkbox.classList.remove('checked');
                    checkbox.classList.add('unchecked');
                });
            
                let selector = '';
                if (menuName === 'dashboard') selector = 'a[href="dashboard.html"]';
                else if (menuName === 'dataset') selector = 'a[href="dataset.html"]';
                else if (menuName === 'analisa') selector = 'a[href="analisa.html"]';
                else if (menuName === 'tes') selector = 'a[href="input.html"]';
                else if (menuName === 'hasil') selector = 'a[href="hasil.html"]';
                else if (menuName === 'riwayat') selector = 'a[href="riwayat.html"]';
                else if (menuName === 'tentang') selector = 'a[href="tentang.html"]';
                
                if (selector) {
                    const activeMenuItem = document.querySelector(selector);
                    if (activeMenuItem) {
                        activeMenuItem.classList.add('active');
                        const checkbox = activeMenuItem.querySelector('.menu-checkbox');
                        if (checkbox) {
                            checkbox.classList.remove('unchecked');
                            checkbox.classList.add('checked');
                        }
                    }
                }
            }
            
            function confirmLogout() {
                return confirm('Apakah Anda yakin ingin logout?');
            }

            // Load user data from localStorage
            function loadUserData() {
                try {
                    let userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                    
                    if (userData) {
                        const user = JSON.parse(userData);
                        const fullName = user.fullName || user.name || 'Pengguna';
                        const email = user.email || 'user@example.com';
                        const gender = user.gender || 'Tidak ditentukan';
                    
                        let genderDisplay = gender;
                        if (gender.toLowerCase() === 'female') genderDisplay = 'Perempuan';
                        else if (gender.toLowerCase() === 'male') genderDisplay = 'Laki-laki';
                        
                        document.getElementById('user-full-name').textContent = fullName;
                        document.getElementById('user-email').textContent = email;
                        document.getElementById('user-gender').textContent = genderDisplay;
                    
                        return { fullName, email, gender: genderDisplay };
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
                return null;
            }

            // Function to track user activity
            function trackActivity(pageName, icon, pageType) {
                const activity = {
                    id: Date.now(),
                    pageName: pageName,
                    icon: icon,
                    pageType: pageType,
                    timestamp: new Date().toISOString()
                };
            
                try {
                    let userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                    if (userData) {
                        const user = JSON.parse(userData);
                        const userId = user.email || user.id || 'anonymous';
                        const storageKey = `user_activities_${userId}`;
                        let activities = JSON.parse(localStorage.getItem(storageKey)) || [];
                        activities.unshift(activity);
                        if (activities.length > 20) activities = activities.slice(0, 20);
                        localStorage.setItem(storageKey, JSON.stringify(activities));
                    }
                } catch (error) {
                    console.error('Error saving activity:', error);
                }
                
                setActiveMenu(pageType);
                return true;
            }

            // Check if user is logged in
            function checkUserLogin() {
                try {
                    const sessionUser = sessionStorage.getItem('currentUser');
                    const localUser = localStorage.getItem('currentUser');
                
                    if (!sessionUser && !localUser) {
                        window.location.href = 'index.html';
                        return false;
                    }
                    return true;
                } catch (error) {
                    window.location.href = 'index.html';
                    return false;
                }
            }
        
            // Initialize
            document.addEventListener('DOMContentLoaded', function() {
                if (!checkUserLogin()) return;
            
                loadUserData();
                updateSummaryStatistics();
                renderResultsTable();
                setActiveMenu('hasil');
            });
        </script>
    </body>
</html>