<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Riwayat & Analisis - Depresychology</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
        
            :root {
                --primary: #667eea;
                --primary-dark: #5a67d8;
                --secondary: #764ba2;
                --light: #f8fafc;
                --dark: #2d3748;
                --gray: #718096;
                --border: #e2e8f0;
                --success: #48bb78;
                --warning: #ed8936;
                --danger: #f56565;
                --info: #4299e1;
                --sidebar-width: 280px;
            }
        
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                color: var(--dark);
                background: #f5f7fa;
                min-height: 100vh;
                display: flex;
                overflow-x: hidden;
            }
        
            .sidebar {
                width: var(--sidebar-width);
                background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
                color: white;
                padding: 20px 0;
                height: 100vh;
                position: fixed;
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
                display: flex;
                flex-direction: column;
                overflow: hidden;
                z-index: 1000;
            }

            .sidebar-content {
                padding: 0 15px;
                flex: 1;
                display: flex;
                flex-direction: column;
                height: 100%;
                overflow: hidden;
            }

            .brand-section {
                margin-bottom: 25px;
                text-align: center;
                padding: 0 10px;
                flex-shrink: 0;
            }

            .brand-icon {
                width: 60px;
                height: 60px;
                margin: 0 auto 12px auto;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.2);
            }

            .brand-logo-img {
                width: 50px;
                height: 50px;
                object-fit: contain;
            }

            .brand-name {
                font-size: 22px;
                font-weight: 700;
                margin-bottom: 3px;
            }

            .brand-tagline {
                font-size: 12px;
                opacity: 0.9;
                letter-spacing: 0.5px;
                white-space: nowrap;
            }

            .user-section {
                margin-bottom: 25px;
                flex-shrink: 0;
            }

            .user-card {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                padding: 15px;
                backdrop-filter: blur(10px);
            }

            .user-name {
                display: flex;
                justify-content: center;
                gap: 6px;
                margin-bottom: 10px;
                font-size: 16px;
                font-weight: 600;
                white-space: nowrap;
            }

            .user-status {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-bottom: 15px;
                font-size: 13px;
            }

            .user-details {
                background: rgba(255, 255, 255, 0.08);
                border-radius: 8px;
                padding: 12px;
            }

            .detail-item {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 8px;
                font-size: 12px;
            }

            .detail-item:last-child {
                margin-bottom: 0;
            }

            .detail-item .detail-icon {
                width: 14px;
                text-align: center;
                flex-shrink: 0;
            }

            .detail-item span {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex: 1;
            }

            .menu-checkbox {
                width: 14px;
                height: 14px;
                border: 2px solid rgba(255, 255, 255, 0.5);
                border-radius: 3px;
                margin-right: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }

            .menu-checkbox.checked::after {
                content: '‚úì';
                font-size: 10px;
                color: white;
            }

            .menu-checkbox.unchecked {
                background: rgba(255, 255, 255, 0.1);
            }

            .menu-section {
                margin-bottom: 15px;
                flex: 1;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }

            .menu-title {
                font-size: 11px;
                text-transform: uppercase;
                letter-spacing: 0.8px;
                margin: 0 0 12px 8px;
                opacity: 0.7;
                font-weight: 600;
                white-space: nowrap;
                flex-shrink: 0;
            }

            .menu-items-container {
                flex: 1;
                overflow-y: auto;
                overflow-x: hidden;
                scrollbar-width: none;
                -ms-overflow-style: none;
                padding-right: 3px;
            }

            .menu-items-container::-webkit-scrollbar {
                display: none;
            }

            .menu-item {
                display: flex;
                align-items: center;
                padding: 10px 12px;
                border-radius: 8px;
                margin-bottom: 6px;
                transition: all 0.2s ease;
                cursor: pointer;
                text-decoration: none;
                color: white;
                font-size: 13px;
                min-width: 0;
                flex-shrink: 0;
            }

            .menu-item:hover {
                background: rgba(255, 255, 255, 0.15);
                transform: translateX(3px);
            }

            .menu-item.active {
                background: rgba(255, 255, 255, 0.2);
                font-weight: 600;
            }

            .menu-item.active .menu-checkbox {
                border-color: white;
            }

            .menu-item.active .menu-checkbox.unchecked::after {
                content: '‚úì';
                font-size: 10px;
                color: white;
            }

            .menu-icon {
                font-size: 14px;
                margin-right: 10px;
                width: 18px;
                text-align: center;
                flex-shrink: 0;
            }

            .menu-text {
                font-size: 13px;
                flex: 1;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                line-height: 1.4;
                white-space: normal;
                word-wrap: break-word;
                max-height: 36px;
                line-clamp: 2;
                box-orient: vertical;
            }

            .logout-section {
                margin-top: auto;
                padding: 10px 0;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                flex-shrink: 0;
            }

            .logout-menu-item {
                display: flex;
                align-items: center;
                padding: 10px 12px;
                border-radius: 8px;
                transition: all 0.2s ease;
                cursor: pointer;
                text-decoration: none;
                color: #fed7d7;
                background: rgba(245, 101, 101, 0.15);
                border: 1px solid rgba(245, 101, 101, 0.3);
                font-size: 13px;
            }

            .logout-menu-item:hover {
                background: rgba(245, 101, 101, 0.25);
                transform: translateX(3px);
                color: #fff5f5;
                border-color: rgba(245, 101, 101, 0.5);
            }

            .logout-menu-icon {
                font-size: 14px;
                margin-right: 10px;
                width: 18px;
                text-align: center;
                flex-shrink: 0;
            }

            .logout-menu-text {
                font-size: 13px;
                flex: 1;
                font-weight: 600;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .logout-menu-checkbox {
                width: 14px;
                height: 14px;
                border: 2px solid rgba(245, 101, 101, 0.5);
                border-radius: 3px;
                margin-right: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(245, 101, 101, 0.1);
                flex-shrink: 0;
            }

            .logout-menu-checkbox.unchecked::after {
                content: 'üö™';
                font-size: 9px;
                color: #fed7d7;
            }
        
            .main-content {
                flex: 1;
                margin-left: var(--sidebar-width);
                padding: 30px;
                min-height: 100vh;
                overflow-y: auto;
                padding-bottom: 50px;
                width: calc(100% - var(--sidebar-width));
            }
        
            .header {
                margin-bottom: 30px;
            }
        
            .page-title {
                font-size: 28px;
                font-weight: 700;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 12px;
            }
        
            .page-icon {
                font-size: 24px;
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
            }
        
            .history-header {
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                border-radius: 16px;
                padding: 30px;
                color: white;
                margin-bottom: 30px;
                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
            }
        
            .history-title {
                font-size: 24px;
                font-weight: 700;
                margin-bottom: 10px;
            }
        
            .history-description {
                font-size: 16px;
                opacity: 0.9;
                margin-bottom: 20px;
                line-height: 1.6;
            }
        
            .stats-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 20px;
            }
        
            .stat-item {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(8px);
                border-radius: 12px;
                padding: 20px;
                text-align: center;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }
        
            .stat-number {
                font-size: 32px;
                font-weight: 700;
                margin-bottom: 8px;
            }
        
            .stat-label {
                font-size: 14px;
                opacity: 0.9;
            }
        
            .tab-navigation {
                background: white;
                border-radius: 16px;
                padding: 0;
                margin-bottom: 30px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
                overflow: hidden;
            }
        
            .tab-buttons {
                display: flex;
                border-bottom: 1px solid var(--border);
            }
        
            .tab-button {
                flex: 1;
                padding: 20px;
                background: none;
                border: none;
                font-size: 16px;
                font-weight: 600;
                color: var(--gray);
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            }
        
            .tab-button:hover {
                background: var(--light);
            }
        
            .tab-button.active {
                color: var(--primary);
                border-bottom: 3px solid var(--primary);
                background: rgba(102, 126, 234, 0.05);
            }

            .tab-content {
                display: none;
                padding: 30px;
            }
        
            .tab-content.active {
                display: block;
            }
        
            .filter-section {
                background: white;
                border-radius: 16px;
                padding: 25px;
                margin-bottom: 30px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
        
            .section-title {
                font-size: 20px;
                font-weight: 700;
                margin-bottom: 20px;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 12px;
            }
        
            .section-icon {
                color: var(--primary);
            }
        
            .filter-controls {
                display: flex;
                gap: 20px;
                flex-wrap: wrap;
            }
        
            .filter-group {
                flex: 1;
                min-width: 200px;
            }
        
            .filter-label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: var(--dark);
                font-size: 14px;
            }
        
            .filter-select {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                background-color: white;
                cursor: pointer;
            }
        
            .filter-select:focus {
                outline: none;
                border-color: var(--primary);
            }
        
            .filter-buttons {
                display: flex;
                gap: 10px;
                margin-top: 20px;
            }
        
            .filter-button {
                padding: 10px 20px;
                background: var(--primary);
                color: white;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
        
            .filter-button:hover {
                background: var(--primary-dark);
            }
        
            .filter-button.secondary {
                background: var(--light);
                color: var(--dark);
                border: 2px solid var(--border);
            }
        
            .filter-button.secondary:hover {
                background: white;
                border-color: var(--primary);
            }
        
            .timeline-section {
                background: white;
                border-radius: 16px;
                padding: 30px;
                margin-bottom: 30px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
        
            .timeline-title {
                font-size: 22px;
                font-weight: 700;
                margin-bottom: 25px;
                color: var(--dark);
                display: flex;
                align-items: center;
                gap: 12px;
            }
        
            .timeline-container {
                position: relative;
                padding-left: 30px;
            }
        
            .timeline-container::before {
                content: '';
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                width: 4px;
                background: linear-gradient(to bottom, var(--primary), var(--secondary));
                border-radius: 2px;
            }
            
            .timeline-item {
                position: relative;
                margin-bottom: 30px;
                padding-bottom: 30px;
                border-bottom: 1px solid var(--border);
            }
        
            .timeline-item:last-child {
                margin-bottom: 0;
                padding-bottom: 0;
                border-bottom: none;
            }
        
            .timeline-marker {
                position: absolute;
                left: -38px;
                top: 0;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                background: var(--primary);
                border: 4px solid white;
                box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
            }
        
            .timeline-content {
                background: var(--light);
                border-radius: 12px;
                padding: 20px;
                border: 1px solid var(--border);
            }
        
            .timeline-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }
        
            .timeline-date {
                font-size: 14px;
                color: var(--primary);
                font-weight: 600;
                background: rgba(102, 126, 234, 0.1);
                padding: 4px 12px;
                border-radius: 20px;
            }
        
            .timeline-test {
                font-size: 18px;
                font-weight: 700;
                color: var(--dark);
            }
        
            .timeline-score {
                display: inline-block;
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 10px;
            }
        
            .score-minimal {
                background: #c6f6d5;
                color: #276749;
            }
        
            .score-mild {
                background: #feebc8;
                color: #975a16;
            }
        
            .score-moderate {
                background: #fbd38d;
                color: #744210;
            }
        
            .score-severe {
                background: #fed7d7;
                color: #9b2c2c;
            }
        
            .score-extreme {
                background: #9b2c2c;
                color: white;
            }
            
            .timeline-description {
                font-size: 14px;
                color: var(--gray);
                line-height: 1.5;
                margin-bottom: 15px;
            }
        
            .timeline-actions {
                display: flex;
                gap: 10px;
            }
        
            .timeline-button {
                padding: 6px 12px;
                border: none;
                border-radius: 6px;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
        
            .timeline-button.view {
                background: var(--info);
                color: white;
            }
        
            .timeline-button.download {
                background: var(--success);
                color: white;
            }
        
            .timeline-button:hover {
                opacity: 0.9;
            }
        
            .analysis-container {
                background: white;
                border-radius: 16px;
                padding: 30px;
                margin-bottom: 30px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
        
            .analysis-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
            }
        
            .analysis-title {
                font-size: 24px;
                font-weight: 700;
                color: var(--dark);
            }
        
            .analysis-actions {
                display: flex;
                gap: 10px;
            }
        
            .analysis-button {
                padding: 10px 20px;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
        
            .analysis-button.primary {
                background: var(--primary);
                color: white;
            }
        
            .analysis-button.secondary {
                background: var(--light);
                color: var(--dark);
                border: 2px solid var(--border);
            }
        
            .analysis-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
        
            .analysis-summary {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
        
            .summary-card {
                background: var(--light);
                border-radius: 12px;
                padding: 25px;
                text-align: center;
                border: 1px solid var(--border);
            }
        
            .summary-icon {
                font-size: 32px;
                margin-bottom: 15px;
            }
        
            .summary-number {
                font-size: 32px;
                font-weight: 700;
                margin-bottom: 8px;
            }
        
            .summary-label {
                font-size: 16px;
                color: var(--gray);
            }
        
            .risk-indicator {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-top: 10px;
                justify-content: center;
            }
        
            .risk-dot {
                width: 12px;
                height: 12px;
                border-radius: 50%;
            }
        
            .risk-low {
                background: var(--success);
            }
        
            .risk-medium {
                background: var(--warning);
            }
        
            .risk-high {
                background: var(--danger);
            }
        
            .analysis-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
        
            .analysis-card {
                background: var(--light);
                border-radius: 12px;
                padding: 25px;
                border: 1px solid var(--border);
            }
        
            .analysis-card-title {
                font-size: 18px;
                font-weight: 700;
                margin-bottom: 15px;
                color: var(--dark);
            }
            
            .factor-list {
                list-style: none;
            }
        
            .factor-item {
                padding: 10px 0;
                border-bottom: 1px solid rgba(0, 0, 0, 0.05);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        
            .factor-item:last-child {
                border-bottom: none;
            }
        
            .factor-name {
                font-size: 14px;
                color: var(--dark);
            }
            
            .factor-score {
                font-weight: 700;
                color: var(--primary);
            }
        
            .chart-placeholder {
                height: 250px;
                background: var(--light);
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--gray);
                font-size: 16px;
                border: 2px dashed var(--border);
                margin-bottom: 20px;
            }
        
            .recommendation-list {
                list-style: none;
            }
        
            .recommendation-item {
                padding: 10px 0;
                border-bottom: 1px solid rgba(0, 0, 0, 0.05);
                display: flex;
                gap: 10px;
            }
        
            .recommendation-item:last-child {
                border-bottom: none;
            }
        
            .recommendation-icon {
                color: var(--primary);
                margin-top: 3px;
            }
        
            .comprehensive-analysis {
                background: white;
                border-radius: 16px;
                padding: 30px;
                margin-bottom: 30px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
                border: 1px solid var(--border);
            }
            
            .user-profile-summary {
                display: flex;
                gap: 30px;
                margin-bottom: 30px;
                padding-bottom: 30px;
                border-bottom: 1px solid var(--border);
            }
        
            .profile-avatar {
                width: 100px;
                height: 100px;
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                border-radius: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 36px;
                color: white;
                flex-shrink: 0;
            }
        
            .profile-info {
                flex: 1;
            }
        
            .profile-name {
                font-size: 24px;
                font-weight: 700;
                margin-bottom: 10px;
                color: var(--dark);
            }
        
            .profile-details {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
        
            .profile-detail {
                display: flex;
                align-items: center;
                gap: 10px;
            }
        
            .profile-detail i {
                color: var(--primary);
                width: 20px;
            }
        
            .condition-summary {
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
                border-radius: 12px;
                padding: 25px;
                margin-bottom: 30px;
                border-left: 4px solid var(--primary);
            }
        
            .condition-title {
                font-size: 20px;
                font-weight: 700;
                margin-bottom: 15px;
                color: var(--dark);
            }
        
            .condition-text {
                font-size: 16px;
                line-height: 1.6;
                color: var(--dark);
            }
        
            .no-history {
                text-align: center;
                padding: 60px 20px;
                color: var(--gray);
            }
        
            .no-history-icon {
                font-size: 64px;
                margin-bottom: 20px;
                opacity: 0.5;
            }
        
            .no-history-title {
                font-size: 24px;
                font-weight: 600;
                margin-bottom: 15px;
                color: var(--dark);
            }
        
            .no-history-description {
                font-size: 16px;
                margin-bottom: 30px;
                max-width: 500px;
                margin-left: auto;
                margin-right: auto;
                line-height: 1.6;
            }
        
            .no-history-button {
                padding: 14px 32px;
                background: var(--primary);
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .no-history-button:hover {
                background: var(--primary-dark);
            }
            
            .footer {
                text-align: center;
                padding: 30px 20px 20px;
                color: var(--gray);
                margin-top: 40px;
                border-top: 1px solid var(--border);
            }
        
            .footer-logo {
                font-size: 20px;
                font-weight: 700;
                color: var(--primary);
                margin-bottom: 8px;
            }
        
            .copyright {
                font-size: 14px;
                opacity: 0.8;
            }
        
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: none;
                justify-content: center;
                align-items: center;
                z-index: 2000;
                padding: 20px;
            }
        
            .modal-overlay.active {
                display: flex;
            }
        
            .modal-content {
                background: white;
                border-radius: 20px;
                max-width: 800px;
                width: 100%;
                max-height: 90vh;
                overflow-y: auto;
                animation: modalSlideIn 0.3s ease;
            }
        
            @keyframes modalSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        
            .modal-header {
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                color: white;
                padding: 30px;
                border-radius: 20px 20px 0 0;
            }
            
            .modal-title {
                font-size: 24px;
                font-weight: 700;
                margin-bottom: 10px;
            }
        
            .modal-subtitle {
                font-size: 16px;
                opacity: 0.9;
            }
        
            .modal-body {
                padding: 30px;
            }
        
            .modal-footer {
                padding: 20px 30px;
                background: var(--light);
                border-radius: 0 0 20px 20px;
                display: flex;
                justify-content: flex-end;
                gap: 15px;
            }
        
            .modal-button {
                padding: 12px 24px;
                border: none;
                border-radius: 8px;
                font-size: 15px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
        
            .modal-button.primary {
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                color: white;
            }
        
            .modal-button.primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }
        
            .modal-button.secondary {
                background: white;
                color: var(--gray);
                border: 2px solid var(--border);
            }

            .modal-button.secondary:hover {
                background: var(--light);
                border-color: var(--primary);
                color: var(--primary);
            }
        
            @media (max-width: 1024px) {
                :root {
                    --sidebar-width: 240px;
                }
            
                .main-content {
                    padding: 25px;
                }
            
                .menu-text {
                    font-size: 12px;
                }
            
                .user-profile-summary {
                    flex-direction: column;
                    align-items: center;
                    text-align: center;
                }
            }

            @media (max-width: 768px) {
                body {
                    flex-direction: column;
                }
            
                .sidebar {
                    width: 100%;
                    height: auto;
                    position: relative;
                    padding: 15px 0;
                    max-height: 70vh;
                    overflow-y: auto;
                }
            
                .sidebar-content {
                    padding: 0 15px;
                    overflow: visible;
                }
            
                .menu-items-container {
                    overflow: visible;
                }
            
                .main-content {
                    margin-left: 0;
                    padding: 20px;
                }
            
                .tab-buttons {
                    flex-direction: column;
                }
            
                .filter-controls {
                    flex-direction: column;
                    gap: 15px;
                }
            
                .timeline-header {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 10px;
                }
            
                .timeline-actions {
                    width: 100%;
                    justify-content: flex-start;
                }
            
                .analysis-header {
                    flex-direction: column;
                    gap: 20px;
                    align-items: flex-start;
                }
            
                .analysis-actions {
                    width: 100%;
                    flex-direction: column;
                }
            }

            @media (max-width: 480px) {
                .stats-container {
                    grid-template-columns: 1fr;
                }
            
                .analysis-summary {
                    grid-template-columns: 1fr;
                }
                
                .analysis-grid {
                    grid-template-columns: 1fr;
                }
            
                .profile-details {
                    grid-template-columns: 1fr;
                }
            
                .menu-text {
                    font-size: 13px;
                    flex: 1;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    display: -webkit-box;
                    display: -moz-box;
                    display: box;
                    -webkit-line-clamp: 2;
                    -moz-line-clamp: 2;
                    line-clamp: 2;
                    -webkit-box-orient: vertical;
                    -moz-box-orient: vertical;
                    box-orient: vertical;
                    line-height: 1.4;
                    white-space: normal;
                    word-wrap: break-word;
                    max-height: 36px;
                }
            
                .brand-name {
                    font-size: 20px;
                }
            
                .page-title {
                    font-size: 22px;
                }
            }
        </style>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
    <body>
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-content">
                <!-- Brand Section -->
                <div class="brand-section">
                    <div class="brand-icon">
                        <img src="Logo Depression Web.png" alt="Depresychology Logo" class="brand-logo-img">
                    </div>
                    <div class="brand-name">Depresychology</div>
                    <div class="brand-tagline">Assessment Psikologis Online</div>
                </div>

                <!-- User Section -->
                <div class="user-section">
                    <div class="user-card">
                        <div class="user-name" id="sidebar-user-name">
                            <span id="user-full-name">Loading...</span>
                        </div>

                        <div class="user-status">
                            <span>Online</span>
                        </div>

                        <div class="user-details">
                            <div class="detail-item">
                                <div class="detail-icon">üìß</div>
                                <span id="user-email">Loading...</span>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">üë§</div>
                                <span id="user-gender">Loading...</span>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">üéÇ</div>
                                <span id="user-age">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Menu Section -->
                <div class="menu-section">
                    <div class="menu-title">MENU UTAMA</div>

                    <div class="menu-items-container">
                        <a href="dashboard.html" class="menu-item" onclick="setActiveMenu('dashboard')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üè†</div>
                            <div class="menu-text">Dashboard</div>
                        </a>

                        <a href="dataset.html" class="menu-item" onclick="setActiveMenu('dataset')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üóÉÔ∏è</div>
                            <div class="menu-text">Psychological Assessment Dataset</div>
                        </a>

                        <a href="analisa.html" class="menu-item" onclick="setActiveMenu('analisa')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üî¨</div>
                            <div class="menu-text">Analisa Psychological Assessment Dataset</div>
                        </a>

                        <a href="input.html" class="menu-item" onclick="setActiveMenu('tes')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üß™</div>
                            <div class="menu-text">Tes Psikologis</div>
                        </a>

                        <a href="hasil.html" class="menu-item" onclick="trackActivity('Hasil Tes', 'üìä', 'hasil')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üìä</div>
                            <div class="menu-text">Hasil Tes Saya</div>
                        </a>

                        <a href="riwayat.html" class="menu-item active" onclick="trackActivity('Riwayat', 'üìú', 'riwayat')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üìú</div>
                            <div class="menu-text">Riwayat & Analisis Saya</div>
                        </a>

                        <a href="tentang.html" class="menu-item" onclick="trackActivity('Tentang Website', 'üí≠', 'tentang')">
                            <div class="menu-checkbox unchecked"></div>
                            <div class="menu-icon">üí≠</div>
                            <div class="menu-text">Tentang website</div>
                        </a>
                    </div>
                </div>
            
                <!-- Logout Section -->
                <div class="logout-section">
                    <a href="index.html" class="logout-menu-item" onclick="return confirmLogout()">
                        <div class="logout-menu-checkbox unchecked"></div>
                        <div class="logout-menu-icon">üö™</div>
                        <div class="logout-menu-text">Keluar</div>
                    </a>
                </div>
            </div>
        </div>
    
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 class="page-title">
                    <span class="page-icon">üìú</span>
                    Riwayat & Analisis Lengkap
                </h1>
            </div>
        
            <!-- History Header -->
            <div class="history-header">
                <h2 class="history-title">Analisis Komprehensif Kesehatan Mental</h2>
                <p class="history-description">
                    Pantau perkembangan dan dapatkan analisis mendalam menggunakan metode AHP-LR 
                    (Analytical Hierarchy Process - Logistic Regression) untuk pemahaman yang lebih 
                    baik tentang kondisi psikologis Anda.
                </p>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-number" id="total-assessments">0</div>
                        <div class="stat-label">Total Assessment</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="average-score-history">0</div>
                        <div class="stat-label">Rata-rata Skor</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="improvement-rate">0%</div>
                        <div class="stat-label">Tingkat Perbaikan</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="consistency-score">0</div>
                        <div class="stat-label">Skor Konsistensi</div>
                    </div>
                </div>
            </div>
        
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="timeline">
                    <i class="fas fa-history"></i>
                        Timeline Assessment
                    </button>
                    <button class="tab-button" data-tab="analysis">
                        <i class="fas fa-chart-bar"></i>
                        Analisis AHP-LR
                    </button>
                    <button class="tab-button" data-tab="comprehensive">
                        <i class="fas fa-clipboard-check"></i>
                        Analisis Komprehensif
                    </button>
                </div>
                
                <!-- Timeline Tab -->
                <div class="tab-content active" id="timeline-tab">
                    <!-- Filter Section -->
                    <div class="filter-section">
                        <h3 class="section-title">
                            <span class="section-icon">üîç</span>
                            Filter Riwayat
                        </h3>
                        
                        <div class="filter-controls">
                            <div class="filter-group">
                                <label class="filter-label">Periode Waktu</label>
                                <select class="filter-select" id="time-period">
                                    <option value="all">Semua Waktu</option>
                                    <option value="7days">7 Hari Terakhir</option>
                                    <option value="30days">30 Hari Terakhir</option>
                                    <option value="3months">3 Bulan Terakhir</option>
                                    <option value="6months">6 Bulan Terakhir</option>
                                    <option value="1year">1 Tahun Terakhir</option>
                                </select>
                            </div>
                        
                            <div class="filter-group">
                                <label class="filter-label">Jenis Tes</label>
                                <select class="filter-select" id="test-type">
                                    <option value="all">Semua Jenis Tes</option>
                                    <option value="all">Dataset</option>
                                    <option value="phq9">PHQ-9</option>
                                    <option value="gad7">GAD-7</option>
                                    <option value="all">PSQI</option>
                                    <option value="all">SHAPS</option>
                                    <option value="all">DSST</option>
                                    <option value="all">Brief COPE Inventory</option>
                                    <option value="dass">DASS-42</option>
                                    <option value="all">PSS</option>
                                    <option value="all">WHO-5</option>
                                    <option value="all">BDI</option>
                                    <option value="all">BAI</option>
                                    <option value="combined">Kombinasi (PHQ-9 dan GAD-7)</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label class="filter-label">Skor Minimum</label>
                                <select class="filter-select" id="min-score">
                                    <option value="0">Semua Skor</option>
                                        <option value="5">‚â• 5 (Ringan)</option>
                                    <option value="10">‚â• 10 (Sedang)</option>
                                    <option value="15">‚â• 15 (Parah)</option>
                                    <option value="20">‚â• 20 (Sangat Parah)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="filter-buttons">
                            <button class="filter-button" id="apply-filter">
                                <i class="fas fa-filter"></i> Terapkan Filter
                            </button>
                            <button class="filter-button secondary" id="reset-filter">
                                <i class="fas fa-redo"></i> Reset Filter
                            </button>
                            <button class="filter-button secondary" id="export-history">
                                <i class="fas fa-download"></i> Ekspor Riwayat
                            </button>
                        </div>
                    </div>
                
                    <!-- Timeline Section -->
                    <div class="timeline-section">
                        <h3 class="timeline-title">
                            <span class="section-icon">‚è≥</span>
                            Timeline Riwayat Assessment
                        </h3>
                    
                        <div id="timeline-container">
                            <!-- Timeline will be loaded here by JavaScript -->
                        </div>
                        
                        <!-- No History Message -->
                        <div id="no-history-message" class="no-history" style="display: none;">
                            <div class="no-history-icon">üìú</div>
                            <h3 class="no-history-title">Belum Ada Riwayat Assessment</h3>
                            <p class="no-history-description">
                                Anda belum memiliki riwayat assessment. Mulailah dengan mengerjakan tes psikologis 
                                pertama Anda untuk memulai perjalanan kesehatan mental yang lebih baik.
                            </p>
                            <button class="no-history-button" onclick="window.location.href='input.html'">
                                <i class="fas fa-play"></i> Mulai Assessment Pertama
                            </button>
                        </div>
                    </div>
                </div>
            
                <!-- AHP-LR Analysis Tab -->
                <div class="tab-content" id="analysis-tab">
                    <div class="analysis-container">
                        <div class="analysis-header">
                            <h3 class="analysis-title">Analisis AHP-LR (Analytical Hierarchy Process - Logistic Regression)</h3>
                            <div class="analysis-actions">
                                <button class="analysis-button primary" onclick="generateAHPReport()">
                                    <i class="fas fa-file-pdf"></i> Generate Report
                                </button>
                                <button class="analysis-button secondary" onclick="refreshAnalysis()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                                </div>
                        </div>
                    
                        <div class="analysis-summary">
                            <div class="summary-card">
                                <div class="summary-icon">üìä</div>
                                <div class="summary-number" id="ahp-total">0</div>
                                <div class="summary-label">Total Analisis</div>
                            </div>
                        
                            <div class="summary-card">
                                <div class="summary-icon">üìà</div>
                                <div class="summary-number" id="ahp-accuracy">0%</div>
                                <div class="summary-label">Akurasi Prediksi</div>
                                </div>
                        
                            <div class="summary-card">
                                <div class="summary-icon">‚ö†Ô∏è</div>
                                <div class="summary-number" id="ahp-risk">0%</div>
                                <div class="summary-label">Risiko Depresi</div>
                                <div class="risk-indicator">
                                    <div class="risk-dot" id="risk-dot"></div>
                                    <span id="risk-text">Rendah</span>
                                </div>
                            </div>
                        </div>
                    
                        <div class="analysis-grid">
                            <div class="analysis-card">
                                <h4 class="analysis-card-title">Faktor Utama Pengaruh</h4>
                                <ul class="factor-list" id="factor-list">
                                    <!-- Factors will be loaded here -->
                                </ul>
                            </div>
                        
                            <div class="analysis-card">
                                <h4 class="analysis-card-title">Prediksi Tren</h4>
                                <div class="chart-placeholder">
                                    <div style="text-align: center;">
                                        <i class="fas fa-chart-line" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
                                        <p>Chart Tren AHP-LR</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h4 class="analysis-card-title">Rekomendasi Berdasarkan AHP-LR</h4>
                                <ul class="recommendation-list" id="ahp-recommendations">
                                    <!-- Recommendations will be loaded here -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- Comprehensive Analysis Tab -->
                <div class="tab-content" id="comprehensive-tab">
                    <div class="comprehensive-analysis">
                        <div class="user-profile-summary">
                            <div class="profile-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="profile-info">
                                <h3 class="profile-name" id="profile-name">Loading...</h3>
                                <div class="profile-details">
                                    <div class="profile-detail">
                                        <i class="fas fa-envelope"></i>
                                        <span id="profile-email">Loading...</span>
                                    </div>
                                    <div class="profile-detail">
                                        <i class="fas fa-venus-mars"></i>
                                        <span id="profile-gender">Loading...</span>
                                    </div>
                                    <div class="profile-detail">
                                        <i class="fas fa-birthday-cake"></i>
                                        <span id="profile-age">Loading...</span>
                                    </div>
                                    <div class="profile-detail">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span id="profile-member">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="condition-summary">
                            <h4 class="condition-title">Ringkasan Kondisi Psikologis</h4>
                            <p class="condition-text" id="condition-summary">
                                Analisis komprehensif menunjukkan kondisi kesehatan mental Anda saat ini. Berdasarkan data dari berbagai tes yang telah Anda selesaikan, kami memberikan gambaran menyeluruh tentang perkembangan dan rekomendasi tindak lanjut.
                            </p>
                        </div>
                    
                       <div class="analysis-grid">
                            <div class="analysis-card">
                                <h4 class="analysis-card-title">Analisis Klinis Psikologis</h4>
                                <div id="clinical-analysis">
                                    <!-- Clinical analysis will be loaded here -->
                                </div>
                            </div>
                        
                            <div class="analysis-card">
                                <h4 class="analysis-card-title">Perbandingan Skor Tes</h4>
                                <div class="chart-placeholder">
                                    <div style="text-align: center;">
                                        <i class="fas fa-chart-bar" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
                                        <p>Perbandingan Skor Semua Tes</p>
                                        <div style="font-size: 14px; margin-top: 10px;">
                                            <div>PHQ-9: <strong id="phq9-score">0</strong></div>
                                            <div>GAD-7: <strong id="gad7-score">0</strong></div>
                                            <div>DASS-42: <strong id="dass-score">0</strong></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="analysis-card">
                                <h4 class="analysis-card-title">Rekomendasi Holistik</h4>
                                <ul class="recommendation-list" id="holistic-recommendations">
                                    <!-- Holistic recommendations will be loaded here -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- Footer -->
            <div class="footer">
                <div class="footer-logo">Depresychology</div>
                <div class="copyright">¬© 2026 Depresychology - Assessment Psikologis Online. Hak cipta dilindungi undang-undang.</div>
            </div>
        </div>
    
        <!-- Detail Modal -->
        <div class="modal-overlay" id="detail-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Detail Assessment</h2>
                    <p class="modal-subtitle" id="modal-subtitle">Detail lengkap assessment dan analisis</p>
                </div>
                
                <div class="modal-body" id="modal-body">
                    <!-- Modal content will be loaded here -->
                </div>
            
                <div class="modal-footer">
                    <button class="modal-button secondary" onclick="closeModal()">
                        Tutup
                    </button>
                    <button class="modal-button primary" onclick="downloadAssessmentDetail()">
                        <i class="fas fa-download"></i> Unduh Detail
                    </button>
                </div>
            </div>
        </div>
        
        <script>
            // Data struktur untuk tes psikologis
            const testDefinitions = {
                phq9: {
                    name: 'PHQ-9 (Patient Health Questionnaire-9)',
                    maxScore: 27,
                    categories: [
                        { min: 0, max: 4, label: 'Minimal', color: 'score-minimal' },
                        { min: 5, max: 9, label: 'Ringan', color: 'score-mild' },
                        { min: 10, max: 14, label: 'Sedang', color: 'score-moderate' },
                        { min: 15, max: 19, label: 'Parah', color: 'score-severe' },
                        { min: 20, max: 27, label: 'Sangat Parah', color: 'score-extreme' }
                    ]
                },
                gad7: {
                    name: 'GAD-7 (Generalized Anxiety Disorder-7)',
                    maxScore: 21,
                    categories: [
                        { min: 0, max: 4, label: 'Minimal', color: 'score-minimal' },
                        { min: 5, max: 9, label: 'Ringan', color: 'score-mild' },
                        { min: 10, max: 14, label: 'Sedang', color: 'score-moderate' },
                        { min: 15, max: 21, label: 'Parah', color: 'score-severe' }
                    ]
                },
                dass42: {
                    name: 'DASS-42 (Depression Anxiety Stress Scales)',
                    maxScore: 126,
                    categories: [
                        { min: 0, max: 28, label: 'Normal', color: 'score-minimal' },
                        { min: 29, max: 56, label: 'Ringan', color: 'score-mild' },
                        { min: 57, max: 84, label: 'Sedang', color: 'score-moderate' },
                        { min: 85, max: 126, label: 'Parah', color: 'score-severe' }
                    ]
                },
                combined: {
                    name: 'Kombinasi PHQ-9 & GAD-7',
                    maxScore: 48,
                    categories: [
                        { min: 0, max: 8, label: 'Normal', color: 'score-minimal' },
                        { min: 9, max: 18, label: 'Ringan', color: 'score-mild' },
                        { min: 19, max: 28, label: 'Sedang', color: 'score-moderate' },
                        { min: 29, max: 38, label: 'Parah', color: 'score-severe' },
                        { min: 39, max: 48, label: 'Sangat Parah', color: 'score-extreme' }
                    ]
                }
            };
            
            // Get user's test results from localStorage
            function getUserTestResults() {
                try {
                    // Get current user
                    const userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                    if (!userData) return [];
                    
                    const user = JSON.parse(userData);
                    const userId = user.email || user.id || 'anonymous';
                    const storageKey = `user_test_results_${userId}`;
                    
                    const results = JSON.parse(localStorage.getItem(storageKey)) || [];
                    return results;
                } catch (error) {
                    console.error('Error loading test results:', error);
                    return [];
                }
            }
        
            // Generate AHP-LR analysis based on test results
            function generateAHPAnalysis(testResults) {
                if (testResults.length === 0) {
                    return null;
                }
            
                // Calculate average scores for each test type
                const scoresByTest = {};
                testResults.forEach(result => {
                    const testType = result.testType || 'combined';
                    if (!scoresByTest[testType]) {
                        scoresByTest[testType] = {
                            total: 0,
                            count: 0,
                            recentScore: result.totalScore || 0
                        };
                    }
                    scoresByTest[testType].total += result.totalScore || 0;
                    scoresByTest[testType].count++;
                    scoresByTest[testType].recentScore = result.totalScore || 0; // Keep most recent
                });
            
                // AHP Factors and weights
                const factors = [
                    { name: 'Depresi (PHQ-9)', weight: 0.4 },
                    { name: 'Kecemasan (GAD-7)', weight: 0.35 },
                    { name: 'Stress (DASS-42)', weight: 0.25 }
                ];
            
                // Calculate factor scores based on actual results
                let totalAHPScore = 0;
                const factorDetails = factors.map(factor => {
                    let score = 0;
                    let normalizedScore = 0;
                
                    if (factor.name.includes('Depresi')) {
                        const phqData = scoresByTest.phq9 || scoresByTest.combined;
                        score = phqData ? phqData.recentScore : 0;
                        normalizedScore = Math.min(1, score / 27); // Normalize to 0-1
                    } else if (factor.name.includes('Kecemasan')) {
                        const gadData = scoresByTest.gad7 || scoresByTest.combined;
                        score = gadData ? gadData.recentScore : 0;
                        normalizedScore = Math.min(1, score / 21); // Normalize to 0-1
                    } else if (factor.name.includes('Stress')) {
                        const dassData = scoresByTest.dass42;
                        score = dassData ? dassData.recentScore : 0;
                        normalizedScore = Math.min(1, score / 126); // Normalize to 0-1
                    }
                
                    const weightedScore = normalizedScore * factor.weight;
                    totalAHPScore += weightedScore;
                    
                    return {
                        name: factor.name,
                        score: score,
                        normalizedScore: normalizedScore.toFixed(2),
                        weightedScore: weightedScore.toFixed(3),
                        weight: factor.weight
                    };
                });
            
                // Logistic Regression Prediction
                const lrPrediction = 1 / (1 + Math.exp(-(totalAHPScore * 10 - 5))); // Simple sigmoid
            
                // Determine risk level
                let riskLevel = 'low';
                let riskText = 'Rendah';
                let riskColor = 'risk-low';
            
                if (lrPrediction > 0.7) {
                    riskLevel = 'high';
                    riskText = 'Tinggi';
                    riskColor = 'risk-high';
                } else if (lrPrediction > 0.4) {
                    riskLevel = 'medium';
                    riskText = 'Sedang';
                    riskColor = 'risk-medium';
                }
            
                // Generate recommendations based on analysis
                const recommendations = [
                    'Monitoring berkala dengan interval 2 minggu',
                    'Terapkan teknik relaksasi dan mindfulness',
                    'Jaga pola tidur yang teratur (7-9 jam/hari)',
                    'Tingkatkan aktivitas fisik minimal 30 menit/hari',
                    'Pertahankan hubungan sosial yang sehat'
                ];
            
                if (riskLevel === 'medium') {
                    recommendations.push('Pertimbangkan konsultasi dengan psikolog');
                    recommendations.push('Ikuti program CBT (Cognitive Behavioral Therapy)');
                } else if (riskLevel === 'high') {
                    recommendations.push('Segera konsultasikan dengan profesional kesehatan mental');
                    recommendations.push('Pertimbangkan evaluasi medis lebih lanjut');
                    recommendations.push('Libatkan keluarga atau teman dekat dalam proses pemulihan');
                }
            
                return {
                    totalAHPScore: totalAHPScore.toFixed(3),
                    lrPrediction: (lrPrediction * 100).toFixed(1),
                    riskLevel: riskLevel,
                    riskText: riskText,
                    riskColor: riskColor,
                    factors: factorDetails,
                    recommendations: recommendations,
                    accuracy: '85%', // Placeholder for accuracy calculation
                    lastUpdated: new Date().toISOString()
                };
            }
        
            // Generate comprehensive analysis
            function generateComprehensiveAnalysis(userData, testResults) {
                if (testResults.length === 0) {
                    return {
                        clinicalAnalysis: 'Belum ada data yang cukup untuk analisis klinis. Selesaikan beberapa tes terlebih dahulu.',
                        phq9Score: 0,
                        gad7Score: 0,
                        dassScore: 0,
                        holisticRecommendations: [
                            'Mulailah dengan mengerjakan tes PHQ-9 dan GAD-7',
                            'Catat pola emosi harian selama 2 minggu',
                            'Konsultasikan dengan profesional jika ada kekhawatiran'
                        ],
                        conditionSummary: 'Data awal belum tersedia. Mulai assessment untuk mendapatkan analisis yang lebih akurat.'
                    };
                }
            
                // Calculate latest scores
                const latestResults = testResults.slice().sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
                );
            
                let phq9Score = 0;
                let gad7Score = 0;
                let dassScore = 0;
                
                latestResults.forEach(result => {
                    const testType = result.testType || 'combined';
                    if (testType === 'phq9' || testType === 'combined') {
                            phq9Score = result.phq9Score || result.totalScore || 0;
                    }
                    if (testType === 'gad7' || testType === 'combined') {
                        gad7Score = result.gad7Score || (testType === 'combined' ? result.totalScore - (result.phq9Score || 0) : result.totalScore) || 0;
                    }
                    if (testType === 'dass42') {
                        dassScore = result.totalScore || 0;
                    }
                });
                
                // Generate clinical analysis
                let clinicalAnalysis = '';
                if (phq9Score <= 4 && gad7Score <= 4) {
                    clinicalAnalysis = 'Hasil menunjukkan kondisi kesehatan mental dalam rentang normal. Tidak ada indikasi gejala depresi atau kecemasan yang signifikan.';
                } else if (phq9Score <= 9 && gad7Score <= 9) {
                    clinicalAnalysis = 'Terdapat gejala ringan depresi dan/atau kecemasan. Disarankan monitoring berkala dan penerapan teknik manajemen stres.';
                } else if (phq9Score <= 14 && gad7Score <= 14) {
                    clinicalAnalysis = 'Gejala sedang depresi dan/atau kecemasan terdeteksi. Disarankan konsultasi dengan profesional kesehatan mental untuk evaluasi lebih lanjut.';
                } else {
                    clinicalAnalysis = 'Gejala signifikan depresi dan/atau kecemasan terdeteksi. Sangat disarankan untuk segera berkonsultasi dengan profesional kesehatan mental.';
                }
            
                // Add DASS analysis if available
                if (dassScore > 0) {
                    if (dassScore <= 28) {
                        clinicalAnalysis += ' Tingkat stres dalam rentang normal.';
                    } else if (dassScore <= 56) {
                        clinicalAnalysis += ' Tingkat stres ringan terdeteksi.';
                    } else if (dassScore <= 84) {
                        clinicalAnalysis += ' Tingkat stres sedang terdeteksi.';
                    } else {
                        clinicalAnalysis += ' Tingkat stres tinggi terdeteksi.';
                    }
                }

                const holisticRecommendations = [ // Generate holistic recommendations
                    'Pertahankan jurnal emosi untuk melacak pola perasaan',
                    'Lakukan aktivitas fisik rutin minimal 3 kali seminggu',
                    'Praktikkan teknik pernapasan dalam saat merasa cemas',
                    'Jaga pola makan sehat dan teratur',
                    'Ciptakan rutinitas tidur yang konsisten'
                ];
            
                if (phq9Score > 9) { // Add specific recommendations based on scores
                    holisticRecommendations.push('Pertimbangkan terapi kognitif perilaku (CBT)');
                    holisticRecommendations.push('Jelajahi teknik mindfulness dan meditasi');
                } if (gad7Score > 9) {
                    holisticRecommendations.push('Batasi konsumsi kafein dan stimulan lainnya');
                    holisticRecommendations.push('Coba teknik grounding saat serangan kecemasan');
                }
            
                // Generate condition summary
                const conditionSummary = `Berdasarkan ${testResults.length} assessment yang telah diselesaikan, 
                analisis menunjukkan perkembangan kesehatan mental Anda. Skor terbaru: Depresi ${phq9Score}/27, 
                Kecemasan ${gad7Score}/21${dassScore > 0 ? `, Stress ${dassScore}/126` : ''}.`;
            
                return {
                    clinicalAnalysis: clinicalAnalysis,
                    phq9Score: phq9Score,
                    gad7Score: gad7Score,
                    dassScore: dassScore,
                    holisticRecommendations: holisticRecommendations,
                    conditionSummary: conditionSummary
                };
            }
            
            // Load user data and initialize page
            function loadUserData() {
                try {
                    const userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                
                    if (userData) {
                        const user = JSON.parse(userData);
                    
                        // Set sidebar user info
                        document.getElementById('user-full-name').textContent = user.fullName || user.name || 'Pengguna';
                        document.getElementById('user-email').textContent = user.email || 'user@example.com';
                    
                        let gender = user.gender || 'Tidak ditentukan';
                        if (gender.toLowerCase() === 'female') gender = 'Perempuan';
                        else if (gender.toLowerCase() === 'male') gender = 'Laki-laki';
                        document.getElementById('user-gender').textContent = gender;
                    
                        // Calculate age if birthDate is available
                        if (user.birthDate) {
                            const birthDate = new Date(user.birthDate);
                            const today = new Date();
                            let age = today.getFullYear() - birthDate.getFullYear();
                            const monthDiff = today.getMonth() - birthDate.getMonth();
                            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                                age--;
                            }
                            document.getElementById('user-age').textContent = `${age} tahun`;
                        } else {
                            document.getElementById('user-age').textContent = user.age ? `${user.age} tahun` : 'Tidak diketahui';
                        }
                    
                        // Set profile info for comprehensive analysis
                        document.getElementById('profile-name').textContent = user.fullName || user.name || 'Pengguna';
                        document.getElementById('profile-email').textContent = user.email || 'user@example.com';
                        document.getElementById('profile-gender').textContent = gender;
                        document.getElementById('profile-age').textContent = user.age ? `${user.age} tahun` : 'Tidak diketahui';
                    
                        // Calculate member since
                        if (user.createdAt) {
                            const createdDate = new Date(user.createdAt);
                            const options = { year: 'numeric', month: 'long', day: 'numeric' };
                            document.getElementById('profile-member').textContent = `Member sejak ${createdDate.toLocaleDateString('id-ID', options)}`;
                        } else {
                            document.getElementById('profile-member').textContent = 'Member baru';
                        }
                    
                        return user;
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
                return null;
            }
        
            // Update statistics
            function updateStatistics() {
                const testResults = getUserTestResults();
            
                document.getElementById('total-assessments').textContent = testResults.length; // Total assessments
                
                // Average score
                if (testResults.length > 0) {
                    const totalScore = testResults.reduce((sum, result) => sum + (result.totalScore || 0), 0);
                    const averageScore = (totalScore / testResults.length).toFixed(1);
                    document.getElementById('average-score-history').textContent = averageScore;
                }
            
                // Improvement rate (simplified)
                if (testResults.length >= 2) {
                    const sortedResults = [...testResults].sort((a, b) => 
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );
                    const latestScore = sortedResults[0].totalScore || 0;
                    const previousScore = sortedResults[1].totalScore || 0;
                    const improvement = previousScore > 0 ? 
                        ((previousScore - latestScore) / previousScore * 100).toFixed(1) : 0;
                    document.getElementById('improvement-rate').textContent = improvement > 0 ? `+${improvement}%` : `${improvement}%`;
                } else {
                    document.getElementById('improvement-rate').textContent = '0%';
                }
            
                // Consistency score
                if (testResults.length > 0) {
                    const scores = testResults.map(r => r.totalScore || 0);
                    const mean = scores.reduce((a, b) => a + b) / scores.length;
                    const variance = scores.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / scores.length;
                    const consistency = Math.max(0, 10 - Math.sqrt(variance));
                    document.getElementById('consistency-score').textContent = consistency.toFixed(1);
                }
            }
        
            // Render timeline
            function renderTimeline(filteredResults = null) {
                const testResults = filteredResults || getUserTestResults();
                const timelineContainer = document.getElementById('timeline-container');
                const noHistoryMessage = document.getElementById('no-history-message');
                
                if (testResults.length === 0) {
                    timelineContainer.innerHTML = '';
                    noHistoryMessage.style.display = 'block';
                    return;
                }
            
                noHistoryMessage.style.display = 'none';
            
                // Sort by date (newest first)
                const sortedResults = [...testResults].sort((a, b) => 
                    new Date(b.timestamp) - new Date(a.timestamp)
                );
            
                const timelineHTML = `
                    <div class="timeline-container">
                        ${sortedResults.map((result, index) => {
                            const testType = result.testType || 'combined';
                            const testDef = testDefinitions[testType] || testDefinitions.combined;
                            const score = result.totalScore || 0;
                        
                            // Find category
                            let category = testDef.categories.find(cat => 
                                score >= cat.min && score <= cat.max
                            ) || testDef.categories[0];
                            
                            // Format date
                            const date = new Date(result.timestamp);
                            const dateString = date.toLocaleDateString('id-ID', {
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });
                            const timeString = date.toLocaleTimeString('id-ID', {
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            
                            // Generate description
                            const description = result.description || 
                                `Assessment ${testDef.name} dengan skor ${score}/${testDef.maxScore}. ${category.label}.`;
                            
                                return `
                                <div class="timeline-item" data-result-id="${result.id}">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <div class="timeline-header">
                                            <div class="timeline-test">${testDef.name}</div>
                                            <div class="timeline-date">${dateString}, ${timeString}</div>
                                        </div>
                                        <div class="timeline-score ${category.color}">
                                            Skor: ${score}/${testDef.maxScore} (${category.label})
                                        </div>
                                        <p class="timeline-description">${description}</p>
                                        <div class="timeline-actions">
                                            <button class="timeline-button view" onclick="viewAssessmentDetail('${result.id}')">
                                                <i class="fas fa-eye"></i> Detail
                                            </button>
                                            <button class="timeline-button download" onclick="downloadAssessment('${result.id}')">
                                                <i class="fas fa-download"></i> Unduh
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            
                timelineContainer.innerHTML = timelineHTML;
            }
        
            // Load AHP-LR analysis
            function loadAHPAnalysis() {
                const testResults = getUserTestResults();
                const analysis = generateAHPAnalysis(testResults);
                
                if (!analysis) {
                    document.getElementById('ahp-total').textContent = '0';
                    document.getElementById('ahp-accuracy').textContent = '0%';
                    document.getElementById('ahp-risk').textContent = '0%';
                    document.getElementById('risk-dot').className = 'risk-dot risk-low';
                    document.getElementById('risk-text').textContent = 'Tidak tersedia';
                    document.getElementById('factor-list').innerHTML = '<li>Tidak ada data analisis</li>';
                    document.getElementById('ahp-recommendations').innerHTML = '<li>Selesaikan beberapa tes terlebih dahulu</li>';
                    return;
                }
            
                document.getElementById('ahp-total').textContent = testResults.length;
                document.getElementById('ahp-accuracy').textContent = analysis.accuracy;
                document.getElementById('ahp-risk').textContent = analysis.lrPrediction + '%';
                document.getElementById('risk-dot').className = `risk-dot ${analysis.riskColor}`;
                document.getElementById('risk-text').textContent = analysis.riskText;
            
                // Load factors
                const factorList = document.getElementById('factor-list');
                factorList.innerHTML = analysis.factors.map(factor => `
                    <li class="factor-item">
                        <span class="factor-name">${factor.name}</span>
                        <span class="factor-score">${factor.weightedScore}</span>
                    </li>
                `).join('');
                    
                // Load recommendations
                const recommendationsList = document.getElementById('ahp-recommendations');
                recommendationsList.innerHTML = analysis.recommendations.map(rec => `
                    <li class="recommendation-item">
                        <i class="fas fa-check-circle recommendation-icon"></i>
                        <span>${rec}</span>
                    </li>
                `).join('');
            }
        
            // Load comprehensive analysis
            function loadComprehensiveAnalysis() {
                const userData = loadUserData();
                const testResults = getUserTestResults();
                const analysis = generateComprehensiveAnalysis(userData, testResults);
            
                document.getElementById('clinical-analysis').textContent = analysis.clinicalAnalysis; // Update clinical analysis
            
                // Update scores
                document.getElementById('phq9-score').textContent = analysis.phq9Score;
                document.getElementById('gad7-score').textContent = analysis.gad7Score;
                document.getElementById('dass-score').textContent = analysis.dassScore;
            
                document.getElementById('condition-summary').textContent = analysis.conditionSummary; // Update condition summary
            
                // Load holistic recommendations
                const recommendationsList = document.getElementById('holistic-recommendations');
                recommendationsList.innerHTML = analysis.holisticRecommendations.map(rec => `
                    <li class="recommendation-item">
                        <i class="fas fa-heart recommendation-icon"></i>
                        <span>${rec}</span>
                    </li>
                `).join('');
            }
        
            // Tab switching
            function setupTabs() {
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabContents = document.querySelectorAll('.tab-content');
            
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => { // Remove active class from all buttons and contents
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        tabContents.forEach(content => content.classList.remove('active'));
                        
                        button.classList.add('active'); // Add active class to clicked button
                    
                        // Show corresponding content
                        const tabName = button.getAttribute('data-tab');
                        document.getElementById(`${tabName}-tab`).classList.add('active');
                        
                        // Load specific tab data
                        if (tabName === 'analysis') {
                            loadAHPAnalysis();
                        } else if (tabName === 'comprehensive') {
                            loadComprehensiveAnalysis();
                        }
                    });
                });
            }
        
            // Filter test results
            function filterTestResults() {
                const timePeriod = document.getElementById('time-period').value;
                const testType = document.getElementById('test-type').value;
                const minScore = parseInt(document.getElementById('min-score').value);
                
                const testResults = getUserTestResults();
                const now = new Date();
                
                let filteredResults = testResults;
                
                // Filter by time period
                if (timePeriod !== 'all') {
                    let days;
                    switch(timePeriod) {
                        case '7days': days = 7; break;
                        case '30days': days = 30; break;
                        case '3months': days = 90; break;
                        case '6months': days = 180; break;
                        case '1year': days = 365; break;
                        default: days = 0;
                    }
                
                    const cutoffDate = new Date(now);
                    cutoffDate.setDate(now.getDate() - days);
                    
                    filteredResults = filteredResults.filter(result => {
                        const resultDate = new Date(result.timestamp);
                        return resultDate >= cutoffDate;
                    });
                }
            
                // Filter by test type
                if (testType !== 'all') {
                    filteredResults = filteredResults.filter(result => {
                        const resultTestType = result.testType || 'combined';
                        return resultTestType === testType;
                    });
                }
            
                // Filter by minimum score
                filteredResults = filteredResults.filter(result => 
                    (result.totalScore || 0) >= minScore
                );
            
                renderTimeline(filteredResults); // Update timeline with filtered results
                showNotification(`Filter diterapkan: ${filteredResults.length} hasil ditemukan`); // Show notification
            }
        
            // Reset filter
            function resetFilter() {
                document.getElementById('time-period').value = 'all';
                document.getElementById('test-type').value = 'all';
                document.getElementById('min-score').value = '0';
            
                renderTimeline();
                updateStatistics();
                showNotification('Filter telah direset');
            }
        
            // Export history
            function exportHistory() {
                const testResults = getUserTestResults();
                
                if (testResults.length === 0) {
                    alert('Tidak ada data riwayat untuk diekspor.');
                    return;
                }
            
                // Create CSV content
                const headers = ['ID', 'Tanggal', 'Jenis Tes', 'Skor Total', 'PHQ-9', 'GAD-7', 'Kategori'];
                const rows = testResults.map(result => {
                    const testType = result.testType || 'combined';
                    const testDef = testDefinitions[testType] || testDefinitions.combined;
                    const score = result.totalScore || 0;
                
                    // Find category
                    const category = testDef.categories.find(cat => 
                        score >= cat.min && score <= cat.max
                    ) || testDef.categories[0];
                    
                    return [
                        `"${result.id}"`,
                        `"${new Date(result.timestamp).toLocaleString('id-ID')}"`,
                        `"${testDef.name}"`,
                        score,
                        result.phq9Score || 'N/A',
                        result.gad7Score || 'N/A',
                        `"${category.label}"`
                    ];
                });
            
                const csvContent = [
                    headers.join(','),
                    ...rows.map(row => row.join(','))
                ].join('\n');
            
                // Create download link
                const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const date = new Date().toISOString().split('T')[0];
                a.download = `riwayat_assessment_${date}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            
                showNotification('Riwayat berhasil diekspor sebagai file CSV!');
            }
        
            // View assessment detail
            function viewAssessmentDetail(resultId) {
                const testResults = getUserTestResults();
                const result = testResults.find(r => r.id === resultId);
            
                if (!result) return;
                
                const testType = result.testType || 'combined';
                const testDef = testDefinitions[testType] || testDefinitions.combined;
                const score = result.totalScore || 0;
            
                // Find category
                const category = testDef.categories.find(cat => 
                    score >= cat.min && score <= cat.max
                ) || testDef.categories[0];
            
                // Format date
                const date = new Date(result.timestamp);
                const dateString = date.toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                const timeString = date.toLocaleTimeString('id-ID', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const specificAnalysis = generateAHPAnalysis([result]); // Generate AHP analysis for this specific result
                document.getElementById('modal-subtitle').textContent = `${testDef.name} - ${dateString}`; // Update modal
            
                const modalBody = document.getElementById('modal-body');
                modalBody.innerHTML = `
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 10px; color: var(--primary);">Informasi Assessment</h3>
                        <p><strong>Jenis Tes:</strong> ${testDef.name}</p>
                        <p><strong>Tanggal:</strong> ${dateString}, ${timeString}</p>
                        <p><strong>Durasi:</strong> ${result.duration ? Math.floor(result.duration / 60) + ' menit ' + (result.duration % 60) + ' detik' : 'Tidak tercatat'}</p>
                    </div>
                    
                    <div style="margin-bottom: 25px; background: var(--light); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 10px; color: var(--primary);">Hasil Skor</h3>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="font-size: 36px; font-weight: bold; color: var(--primary);">${score}</div>
                            <div>
                                <div><strong>Skor Total:</strong> ${score}/${testDef.maxScore}</div>
                                <div><strong>Kategori:</strong> <span class="${category.color}" style="padding: 4px 8px; border-radius: 4px;">${category.label}</span></div>
                            </div>
                        </div>
                    
                        ${result.phq9Score ? `<p><strong>PHQ-9 Score:</strong> ${result.phq9Score}/27</p>` : ''}
                        ${result.gad7Score ? `<p><strong>GAD-7 Score:</strong> ${result.gad7Score}/21</p>` : ''}
                    </div>
                
                    ${specificAnalysis ? `
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 10px; color: var(--primary);">Analisis AHP-LR</h3>
                        <p><strong>Total Skor AHP:</strong> ${specificAnalysis.totalAHPScore}</p>
                        <p><strong>Prediksi LR:</strong> ${specificAnalysis.lrPrediction}%</p>
                        <p><strong>Level Risiko:</strong> <span style="color: ${specificAnalysis.riskColor === 'risk-high' ? 'var(--danger)' : specificAnalysis.riskColor === 'risk-medium' ? 'var(--warning)' : 'var(--success)'}">${specificAnalysis.riskText}</span></p>
                    </div>
                
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 10px; color: var(--primary);">Rekomendasi</h3>
                        <ul style="padding-left: 20px;">
                            ${specificAnalysis.recommendations.map(rec => `<li style="margin-bottom: 8px;">${rec}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                
                    <div>
                        <h3 style="margin-bottom: 10px; color: var(--primary);">Analisis Klinis</h3>
                        <p>${result.description || 'Analisis klinis berdasarkan skor yang diperoleh. ' + category.label + '.'}</p>
                    </div>
                `;
            
                document.getElementById('detail-modal').classList.add('active'); // Show modal
            }
        
            // Close modal
            function closeModal() {
                document.getElementById('detail-modal').classList.remove('active');
            }
        
            // Download assessment
            function downloadAssessment(resultId) {
                const testResults = getUserTestResults();
                const result = testResults.find(r => r.id === resultId);
            
                if (!result) return;
                
                const testType = result.testType || 'combined';
                const testDef = testDefinitions[testType] || testDefinitions.combined;
                const score = result.totalScore || 0;
                
                // Format date
                const date = new Date(result.timestamp);
                const dateString = date.toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            
                // Create report text
                const report = `
                DEPRESYCHOLOGY - DETAIL ASSESSMENT
                ===================================

                INFORMASI TES
                -------------
                Jenis Tes: ${testDef.name}
                Tanggal: ${dateString}
                Skor Total: ${score}/${testDef.maxScore}
                HASIL DETAIL
                ------------
                ${result.phq9Score ? `PHQ-9 (Depresi): ${result.phq9Score}/27` : ''}
                ${result.gad7Score ? `GAD-7 (Kecemasan): ${result.gad7Score}/21` : ''}

                ANALISIS KLINIS
                ---------------
                ${result.description || 'Analisis berdasarkan skor yang diperoleh.'}

                REKOMENDASI
                -----------
                ${generateAHPAnalysis([result])?.recommendations.map(rec => `‚Ä¢ ${rec}`).join('\n') || '‚Ä¢ Monitoring berkala dianjurkan'}

                ---
                CATATAN: Informasi ini untuk pemantauan pribadi.
                Konsultasikan dengan profesional kesehatan mental untuk diagnosis dan perawatan.
                `;
            
                // Create download link
                const blob = new Blob([report], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const safeTestName = testDef.name.replace(/[^a-zA-Z0-9]/g, '_');
                a.download = `Assessment_${safeTestName}_${dateString.replace(/[^a-zA-Z0-9]/g, '_')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('Detail assessment berhasil diunduh!');
            }
        
            // Download assessment detail from modal
            function downloadAssessmentDetail() {
                const modalSubtitle = document.getElementById('modal-subtitle').textContent;
                const modalBody = document.getElementById('modal-body').innerText;
            
                const report = `
                DEPRESYCHOLOGY - DETAIL LENGKAP
                ================================
                ${modalSubtitle}
                ${modalBody}
                ---
                Dicetak pada: ${new Date().toLocaleString('id-ID')}
                `;
            
                const blob = new Blob([report], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Detail_Assessment_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            
                showNotification('Detail lengkap berhasil diunduh!');
            }
        
            // Generate AHP report
            function generateAHPReport() {
                const testResults = getUserTestResults();
            
                if (testResults.length === 0) {
                    alert('Tidak ada data untuk generate report.');
                    return;
                }
            
                const analysis = generateAHPAnalysis(testResults);
                const userData = loadUserData();
                
                const report = `
                DEPRESYCHOLOGY - LAPORAN AHP-LR
                ================================

                INFORMASI PENGUNJUNG
                --------------------
                Nama: ${userData?.fullName || userData?.name || 'Pengguna'}
                Email: ${userData?.email || 'Tidak tersedia'}
                Tanggal Laporan: ${new Date().toLocaleDateString('id-ID')}

                STATISTIK ASSESSMENT
                --------------------
                Total Assessment: ${testResults.length}
                Periode: ${new Date(testResults[testResults.length-1]?.timestamp).toLocaleDateString('id-ID')} - ${new Date(testResults[0]?.timestamp).toLocaleDateString('id-ID')}

                HASIL ANALISIS AHP-LR
                ---------------------
                Total Skor AHP: ${analysis?.totalAHPScore || '0'}
                Prediksi Logistic Regression: ${analysis?.lrPrediction || '0'}%
                Level Risiko: ${analysis?.riskText || 'Tidak tersedia'}

                FAKTOR UTAMA
                ------------
                ${analysis?.factors.map(f => `${f.name}: ${f.score} (Bobot: ${f.weight}, Normalized: ${f.normalizedScore})`).join('\n') || 'Tidak tersedia'}

                REKOMENDASI
                -----------
                ${analysis?.recommendations.map(r => `‚Ä¢ ${r}`).join('\n') || '‚Ä¢ Tidak tersedia'}

                ---
                Laporan ini dihasilkan otomatis oleh sistem Depresychology.
                Untuk interpretasi klinis, konsultasikan dengan profesional kesehatan mental.
                `;
            
                const blob = new Blob([report], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Laporan_AHP_LR_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            
                showNotification('Laporan AHP-LR berhasil di-generate!');
            }
        
            // Refresh analysis
            function refreshAnalysis() {
                loadAHPAnalysis();
                showNotification('Analisis telah direfresh');
            }
        
            // Show notification
            function showNotification(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--primary);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            
                // Add CSS for animations if not exists
                if (!document.getElementById('notification-animations')) {
                    const style = document.createElement('style');
                    style.id = 'notification-animations';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
        
            // Menu functions
            function setActiveMenu(menuName) {
                const menuItems = document.querySelectorAll('.menu-item');
                
                menuItems.forEach(item => {
                    item.classList.remove('active');
                    const checkbox = item.querySelector('.menu-checkbox');
                    if (checkbox) {
                        checkbox.classList.remove('checked');
                        checkbox.classList.add('unchecked');
                    }
                });
            
                let selector = '';
                if (menuName === 'dashboard') selector = 'a[href="dashboard.html"]';
                else if (menuName === 'dataset') selector = 'a[href="dataset.html"]';
                else if (menuName === 'analisa') selector = 'a[href="analisa.html"]';
                else if (menuName === 'tes') selector = 'a[href="input.html"]';
                else if (menuName === 'hasil') selector = 'a[href="hasil.html"]';
                else if (menuName === 'riwayat') selector = 'a[href="riwayat.html"]';
                else if (menuName === 'tentang') selector = 'a[href="tentang.html"]';
            
                if (selector) {
                    const activeMenuItem = document.querySelector(selector);
                    if (activeMenuItem) {
                        activeMenuItem.classList.add('active');
                        const checkbox = activeMenuItem.querySelector('.menu-checkbox');
                        if (checkbox) {
                            checkbox.classList.remove('unchecked');
                            checkbox.classList.add('checked');
                        }
                    }
                }
            }
        
            function confirmLogout() {
                return confirm('Apakah Anda yakin ingin logout?');
            }
        
            function trackActivity(pageName, icon, pageType) {
                const activity = {
                    id: Date.now(),
                    pageName: pageName,
                    icon: icon,
                    pageType: pageType,
                    timestamp: new Date().toISOString()
                };
            
                try {
                    const userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                    if (userData) {
                        const user = JSON.parse(userData);
                        const userId = user.email || user.id || 'anonymous';
                        const storageKey = `user_activities_${userId}`;
                        let activities = JSON.parse(localStorage.getItem(storageKey)) || [];
                        activities.unshift(activity);
                        if (activities.length > 20) activities = activities.slice(0, 20);
                        localStorage.setItem(storageKey, JSON.stringify(activities));
                    }
                } catch (error) {
                    console.error('Error saving activity:', error);
                }
            
                setActiveMenu(pageType);
                return true;
            }
        
            // Check if user is logged in
            function checkUserLogin() {
                try {
                    const sessionUser = sessionStorage.getItem('currentUser');
                    const localUser = localStorage.getItem('currentUser');
                    
                    if (!sessionUser && !localUser) {
                        window.location.href = 'index.html';
                        return false;
                    }
                    return true;
                } catch (error) {
                    window.location.href = 'index.html';
                    return false;
                }
            }
        
            // Initialize page
            document.addEventListener('DOMContentLoaded', function() {
                if (!checkUserLogin()) return;
            
                loadUserData();
                updateStatistics();
                renderTimeline();
                setupTabs();
                loadAHPAnalysis();
                loadComprehensiveAnalysis();
                setActiveMenu('riwayat');
                
                // Event listeners
                document.getElementById('apply-filter').addEventListener('click', filterTestResults);
                document.getElementById('reset-filter').addEventListener('click', resetFilter);
                document.getElementById('export-history').addEventListener('click', exportHistory);
            
                // Close modal on overlay click
                document.getElementById('detail-modal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('detail-modal')) {
                        closeModal();
                    }
                });
            
                console.log('Riwayat & Analisis page loaded successfully!');
            });
        </script>
    </body>
</html>